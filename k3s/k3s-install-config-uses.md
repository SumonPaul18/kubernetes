### USER
root@k8sworker:~/kube-text# kubectl get nodes
NAME        STATUS   ROLES                  AGE   VERSION
k8sworker   Ready    control-plane,master   11h   v1.33.5+k3s1
root@k8sworker:~/kube-text# 

ржПржЗ Server ржП kubernets ржПрж░ ржХрзЛржи ржнрж╛рж░рзНрж╕ржи ржмрж╛ ржХрзЛржи ржоржбрзЗрж▓ Install ржХрж░рж╛ ржЖржЫрзЗ ? ржХрж┐ржнрж╛ржмрзЗ ржмрзБржЭржмрзЛ? ржЖрж░ ржХрж┐ржнрж╛ржмрзЗ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░ржмрзЛ? 

### ASSISTANT
ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ **k3s** ржирж╛ржорзЗрж░ ржПржХржЯрж┐ **lightweight Kubernetes ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи** ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржЖржЫрзЗред  
`kubectl get nodes` ржЖржЙржЯржкрзБржЯрзЗ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ ржпрзЗ ржирзЛржбрзЗрж░ **VERSION** рж╣ржЪрзНржЫрзЗ `v1.33.5+k3s1` тАФ ржПржЦрж╛ржирзЗ `+k3s1` рж╕рж╛ржлрж┐ржХрзНрж╕ржЯрж┐ ржирж┐рж░рзНржжрзЗрж╢ ржХрж░рзЗ ржпрзЗ ржПржЯрж┐ **k3s**, рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржб Kubernetes (k8s) ржиржпрж╝ред

---

### тЬЕ ржХрзАржнрж╛ржмрзЗ ржмрзБржЭржмрзЗржи ржХрзЛржи ржоржбрзЗрж▓/ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи ржЗржирж╕рзНржЯрж▓ ржЖржЫрзЗ?

1. **kubectl version** ржЪрж╛рж▓рж┐ржпрж╝рзЗ ржжрзЗржЦрзБржи:
   ```bash
   kubectl version --short
   ```
   ржЖржЙржЯржкрзБржЯрзЗ `Server Version`-ржП `k3s` ржжрзЗржЦрж╛ ржпрж╛ржмрзЗред

2. **k3s рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрзЗржХ ржХрж░рзБржи**:
   ```bash
   systemctl status k3s
   ```
   ржЖржЙржЯржкрзБржЯрзЗ `k3s.service` ржЪрж╛рж▓рзБ ржерж╛ржХрж▓рзЗ ржирж┐рж╢рзНржЪрж┐ржд рж╣ржмрзЗржиред

3. **k3s ржмрж╛ржЗржирж╛рж░рж┐ ржЪрзЗржХ ржХрж░рзБржи**:
   ```bash
   which k3s
   # рж╕рж╛ржзрж╛рж░ржгржд /usr/local/bin/k3s
   ```

4. **ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж▓рзЛржХрзЗрж╢ржи**:
   k3s ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ ржХржиржлрж┐ржЧ рж░рж╛ржЦрзЗ `/etc/rancher/k3s/k3s.yaml`-ржП:
   ```bash
   ls /etc/rancher/k3s/
   ```

---

### ЁЯФН ржХрзАржнрж╛ржмрзЗ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░ржмрзЗржи ржпрзЗ ржПржЯрж┐ ржарж┐ржХржарж╛ржХ ржХрж╛ржЬ ржХрж░ржЫрзЗ?

1. **ржирзЛржб рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕** (ржЗрждрж┐ржоржзрзНржпрзЗ ржжрзЗржЦрзЗржЫрзЗржи):
   ```bash
   kubectl get nodes
   ```
   `STATUS` `Ready` рж╣рж▓рзЗ ржарж┐ржХ ржЖржЫрзЗред

2. **Pods ржЪрзЗржХ ржХрж░рзБржи (system namespace)**:
   ```bash
   kubectl get pods -A
   ```
   `kube-system` ржПржмржВ `local-path-storage`, `metrics-server` ржЗрждрзНржпрж╛ржжрж┐ ржкржбржЧрзБрж▓рзЛ `Running` ржЕржмрж╕рзНржерж╛ржпрж╝ ржерж╛ржХрж╛ ржЙржЪрж┐рждред

3. **k3s рж▓ржЧ ржжрзЗржЦрзБржи (ржпржжрж┐ рж╕ржорж╕рзНржпрж╛ ржерж╛ржХрзЗ)**:
   ```bash
   journalctl -u k3s -f
   ```

---

### ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ:

| ржмрж┐рж╖ржпрж╝ | ржорж╛ржи |
|------|-----|
| **Kubernetes ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи** | k3s (by Rancher Labs) |
| **K8s ржнрж╛рж░рзНрж╕ржи** | v1.33.5 |
| **ржирзЛржб рж░рзЛрж▓** | Single-node control-plane (master) |
| **ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржорзЗржержб** | рж╕ржорзНржнржмржд `curl -sfL https://get.k3s.io | sh -` |

---

ржЖржкржирж┐ ржпржжрж┐ **multi-node cluster**, **FluxCD**, **GitOps**, ржЕржержмрж╛ **k3s-ржПрж░ production use case** ржирж┐ржпрж╝рзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржЪрж╛ржи тАФ рж╕рзЗржЧрзБрж▓рзЛржУ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржЧрж╛ржЗржб ржХрж░рждрзЗ ржкрж╛рж░рж┐ред рж╢рзБржзрзБ ржЬрж╛ржирж╛ржи! ЁЯЪА

### USER
рж╣рзНржпрж╛ржБ ржЖржорж┐ ржарж┐ржХ ржмрж▓рзЗржЫрзЗржи ржПржЗ рж╕рж╛рж░рзНржнрж╛рж░рзЗ k3s install ржХрж░рж╛ ржЖржЫрзЗред
ржПржЦржи ржЖржорж╛ржХрзЗ k3s рж╕ржорзНржкрж░рзНржХрзЗ k3s ржПрж░ рж╕ржорж╕рзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржмрж┐рж╖рзЯ ржирж┐рзЯрзЗ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЖрж▓рзЛржЪржирж╛ ржХрж░рзБржиред

### ASSISTANT
ржЕржмрж╢рзНржпржЗ! ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ ржПржХржЬржи ржЕржнрж┐ржЬрзНржЮ DevOps & Cloud Engineer ржПржмржВ ржирж┐ржЬрзЗрж░ ржШрж░рзЗрж░ рж▓рзНржпрж╛ржмрзЗ ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб, OpenStack, ржПржмржВ Kubernetes ржирж┐ржпрж╝рзЗ ржХрж╛ржЬ ржХрж░рзЗржи тАФ рждрж╛ржЗ **k3s**-ржПрж░ ржЖрж▓рзЛржЪржирж╛ ржХрж░ржм ржПржоржиржнрж╛ржмрзЗ ржпрзЗржи ржПржЯрж┐ ржЖржкржирж╛рж░ рж░рж┐ржпрж╝рзЗрж▓-ржУржпрж╝рж╛рж░рзНрж▓рзНржб ржкрзНрж░ржЬрзЗржХрзНржЯ, рж▓рж╛ржЗржЯржУржпрж╝рзЗржЯ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░, ржПржмржВ ржПржЬ/рж╣рзЛржо рж▓рзНржпрж╛ржм рж╕рзНржХрзЗржирж╛рж░рж┐ржУрждрзЗ ржкрзНрж░ржпрзЛржЬрзНржп рж╣ржпрж╝ред

---

## ЁЯФ╣ k3s ржХрзА? (Kubernetes, but Light)

**k3s** рж╣рж▓ **Rancher Labs** ржжрзНржмрж╛рж░рж╛ рждрзИрж░рж┐ ржПржХржЯрж┐ **CNCF-certified**, **lightweight**, **fully compliant** Kubernetes ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи тАФ ржпрж╛ ржбрж┐ржЬрж╛ржЗржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ **resource-constrained**, **edge**, **IoT**, ржПржмржВ **development/lab environments**-ржПрж░ ржЬржирзНржпред

> ЁЯУМ **"k3s = k8s тАУ bloat + simplicity"**

---

## ЁЯФ╣ k3s vs k8s: ржорзВрж▓ ржкрж╛рж░рзНржержХрзНржп

| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп | k8s (Vanilla) | k3s |
|-----------|----------------|------|
| **Binary Size** | ~100s MB (multiple components) | ~50тАУ70 MB (single binary) |
| **Installation** | kubeadm, kops, etc. (complex) | `curl -sfL https://get.k3s.io \| sh -` |
| **Dependencies** | Docker/containerd, etcd, kubelet, etc. | Built-in containerd, SQLite (default), embedded etcd (optional) |
| **Resource Usage** | High (2+ GB RAM, multi-core) | Low (~512MB RAM suffices) |
| **Control Plane** | Separate etcd, API server, scheduler | All-in-one binary |
| **Default DB** | etcd | SQLite (but supports etcd, MySQL, PostgreSQL) |
| **Use Case** | Production data centers | Edge, CI/CD, home labs, ARM devices |

тЬЕ **k3s ржЖрж╕рж▓рзЗржЗ full-featured Kubernetes** тАФ `kubectl`, `Deployments`, `Services`, `Helm`, `CRDs`, `RBAC`, `Network Policies` рж╕ржмржХрж┐ржЫрзБ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗред

---

## ЁЯФ╣ k3s-ржПрж░ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ (Simplified)

```
k3s binary
тФВ
тФЬтФАтФА containerd (built-in CRI)
тФЬтФАтФА SQLite (or external DB)
тФЬтФАтФА Core Kubernetes components (API server, controller-manager, scheduler)
тФЬтФАтФА Traefik (default ingress controller, optional)
тФЬтФАтФА Local-path provisioner (default storage)
тФЬтФАтФА CoreDNS + Metrics Server (bundled)
тФФтФАтФА Flannel (CNI, default тАФ but replaceable)
```

> ЁЯТб ржПржХржЯрж┐ ржПржХржХ `k3s` ржмрж╛ржЗржирж╛рж░рж┐ рж╕ржмржХрж┐ржЫрзБ ржЪрж╛рж▓рж╛ржпрж╝ тАФ ржХрзЛржирзЛ `kubelet`, `kube-proxy` ржкрзНрж░рж╕рзЗрж╕ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ ржжрзЗржЦрж╛ ржпрж╛ржпрж╝ ржирж╛ред

---

## ЁЯФ╣ k3s ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи (Recap for Your Lab)

```bash
# Master (control-plane) node
curl -sfL https://get.k3s.io | sh -

# Worker node (optional)
curl -sfL https://get.k3s.io | K3S_URL=https://<MASTER_IP>:6443 K3S_TOKEN=<TOKEN> sh -
```

- **Token** ржкрж╛ржмрзЗржи: `/var/lib/rancher/k3s/server/node-token`
- **kubeconfig**: `/etc/rancher/k3s/k3s.yaml`
- **Auto-start**: systemd service (`k3s.service`) рж╣рж┐рж╕рзЗржмрзЗ ржЗржирж╕рзНржЯрж▓ рж╣ржпрж╝

> тЬЕ ржЖржкржирж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ: single-node cluster тЖТ control-plane + worker in one.

---

## ЁЯФ╣ k3s-ржПрж░ ржХрж┐ржЫрзБ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржлрж┐ржЪрж╛рж░

### 1. **Embedded High Availability Options**
- **SQLite** (default, single-node)
- **Embedded etcd** (multi-node HA without external DB):
  ```bash
  k3s server --cluster-init  # first node
  k3s server --server https://<IP>:6443 --token <TOKEN>  # others
  ```

### 2. **Replaceable Components**
- **CNI**: Flannel (default), but Calico, Cilium, etc. ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝
- **Ingress**: Traefik (default), disable with `--disable traefik`
- **Storage**: `local-path-provisioner` (default), or use Longhorn, NFS, etc.

### 3. **Air-gapped / Offline Install**
- ржкрзБрж░рзЛ ржмрж╛ржЗржирж╛рж░рж┐ ржПржХ ржлрж╛ржЗрж▓рзЗ тАФ ржЕржлрж▓рж╛ржЗржи рж▓рзНржпрж╛ржмрзЗ ржкрж╛рж░ржлрзЗржХрзНржЯ
- Airgap images bundle: `k3s-airgap-images-<arch>.tar`

### 4. **ARM / Raspberry Pi Support**
- `arm64`, `arm/v7` рж╕рж╛ржкрзЛрж░рзНржЯ тАФ ржПржЬ ржбрж┐ржнрж╛ржЗрж╕рзЗ Kubernetes ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп ржЖржжрж░рзНрж╢

### 5. **Security by Default**
- **No Docker dependency** (uses containerd)
- **Minimal attack surface**
- **Automatic TLS bootstrap**

---

## ЁЯФ╣ ржХрзЛржерж╛ржпрж╝ k3s ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?

| рж╕рзНржХрзЗржирж╛рж░рж┐ржУ | ржХрзЗржи k3s? |
|-----------|--------|
| **рж╣рзЛржо рж▓рзНржпрж╛ржм / ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб** | ржХржо рж░рж┐рж╕рзЛрж░рзНрж╕рзЗ full K8s experience |
| **CI/CD ржЯрзЗрж╕рзНржЯрж┐ржВ (e.g., GitHub Actions)** | ржжрзНрж░рзБржд рж╕рзНржкрж┐ржи ржЖржк/ржбрж╛ржЙржи |
| **Edge Computing (ржлрзНржпрж╛ржХрзНржЯрж░рж┐, рж░рж┐ржЯрзЗржЗрж▓)** | рж▓рзЛ-ржкрж╛ржУржпрж╝рж╛рж░, ржЕржлрж▓рж╛ржЗржи ржЕржкрж╛рж░рзЗрж╢ржи |
| **GitOps (FluxCD, Argo CD)** | Lightweight cluster for declarative infra |
| **Kubernetes рж╢рзЗржЦрж╛** | ржЬржЯрж┐рж▓рждрж╛ ржЫрж╛ржбрж╝рж╛ржЗ рж╣рж╛рждрзЗ-ржХрж▓ржорзЗ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ |

> ЁЯМ▒ ржЖржкржирж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ: **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб + GitOps (FluxCD)** тАФ k3s рж╣рж▓ ржкрж╛рж░ржлрзЗржХрзНржЯ ржорзНржпрж╛ржЪ!

---

## ЁЯФ╣ k3s ржХрж╛рж╕рзНржЯржорж╛ржЗржЬрзЗрж╢ржи (ржЖржкржирж╛рж░ рж▓рзНржпрж╛ржмрзЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝)

### Disable Traefik (if using Nginx-ingress):
```bash
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--disable traefik" sh -
```

### Use external DB (e.g., for HA):
```bash
k3s server --datastore-endpoint="mysql://user:pass@tcp(db:3306)/k3s"
```

### Custom kubeconfig location:
```bash
K3S_KUBECONFIG_MODE="644" K3S_KUBECONFIG_OUTPUT="/root/.kube/config" ...
```

---

## ЁЯФ╣ ржоржирж┐ржЯрж░рж┐ржВ ржУ ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ

- **Logs**: `journalctl -u k3s -f`
- **Pods**: `kubectl get pods -A`
- **Node info**: `kubectl describe node k8sworker`
- **Check version**: `k3s --version`

> тЪая╕П **рж╕рждрж░рзНржХрждрж╛**: k3s ржбрж┐ржлрж▓рзНржЯрзЗ **80/443 ржкрзЛрж░рзНржЯ ржирзЗржпрж╝** (Traefik ржЬржирзНржп) тАФ Portainer, Nginx ржЗрждрзНржпрж╛ржжрж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ рж╕ржоржпрж╝ ржкрзЛрж░рзНржЯ ржХржиржлрзНрж▓рж┐ржХрзНржЯ рж╣рждрзЗ ржкрж╛рж░рзЗред

---

## ЁЯФ╣ ржХрзАржнрж╛ржмрзЗ k3s ржЖржкржЧрзНрж░рзЗржб ржХрж░ржмрзЗржи?

```bash
# Automatic (default)
k3s -v  # current version

# Manual
curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=v1.34.0+k3s1 sh -
```

> k3s рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЖржкржЧрзНрж░рзЗржб ржЕржл ржХрж░рж╛ ржпрж╛ржпрж╝ (`--disable-agent` ржмрж╛ config)

---

## ЁЯФ╣ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк: k3s-ржПрж░ USP (Unique Selling Points)

- тЬЕ **50MB, 1 binary, 1 command install**
- тЬЕ **No Docker, no etcd (by default)**
- тЬЕ **Full Kubernetes API compatibility**
- тЬЕ **Perfect for ARM, edge, and home labs**
- тЬЕ **GitOps-ready out-of-the-box**
- тЬЕ **CNCF certified тАФ production-ready**

---

## ЁЯФЪ ржЙржкрж╕ржВрж╣рж╛рж░

ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ **OpenStack-ржП ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб**, **FluxCD-ржП GitOps**, ржПржмржВ **ржХржо рж░рж┐рж╕рзЛрж░рзНрж╕рзЗ maximum control** ржЪрж╛ржи тАФ **k3s ржЖржкржирж╛рж░ рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗрж░ ржЖржжрж░рзНрж╢ Kubernetes runtime**ред

ржПржЯрж┐ рж╢рзБржзрзБ "рж╣рж╛рж▓ржХрж╛" ржиржпрж╝ тАФ ржПржЯрж┐ **рж╕рзНржорж╛рж░рзНржЯ, рж╕рж┐ржХрж┐ржЙрж░, ржПржмржВ рж╕рзНржХрзЗрж▓рзЗржмрж▓**ред  
ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ k3s-ржПрж░ ржЙржкрж░рзЗ **Longhorn (storage)**, **Cilium (CNI)**, **MetalLB (LoadBalancer)** ржмрж╕рж┐ржпрж╝рзЗ ржПржХржЯрж┐ **production-grade home cloud** ржмрж╛ржирж╛рждрзЗ ржкрж╛рж░рзЗржиред

ржЪрж╛ржЗрж▓рзЗ ржПржЦржи ржерзЗржХрзЗ **k3s + FluxCD + SOPS + GitHub** ржжрж┐ржпрж╝рзЗ **fully automated, secure, Git-driven home cluster** рж╕рзЗржЯржЖржк ржХрж░рж╛рж░ ржзрж╛ржкржЧрзБрж▓рзЛ ржирж┐ржпрж╝рзЗ ржЖрж▓рзЛржЪржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред ЁЯЫая╕П

ржЖржкржирж╛рж░ ржкрж░ржмрж░рзНрждрзА рж▓ржХрзНрж╖рзНржп ржХрзА?

### USER
ржЖржорж╛ржХрзЗржГ
рззред k3s-ржПрж░ ржЙржкрж░рзЗ Longhorn (storage), Cilium (CNI), MetalLB (LoadBalancer) ржмрж╕рж┐ржпрж╝рзЗ ржПржХржЯрж┐ production-grade home cloud ржмрж╛ржирж╛ржирзЛрж░ ржЧрж╛ржЗржб ржжрж┐ржмрзЗржи ржкрж░рзЗред  

рзиред k3s + FluxCD + SOPS + GitHub ржжрж┐ржпрж╝рзЗ fully automated, secure, Git-driven home cluster рж╕рзЗржЯржЖржк ржХрж░рж╛рж░ ржзрж╛ржкржЧрзБрж▓рзЛ ржирж┐ржпрж╝рзЗ ржЖрж▓рзЛржЪржирж╛ ржХрж░ржмрзЗ ржкрж░рзЗред

ржПржЦржи ржЖржорж╛ржХрзЗ k3s ржП ржХрж╛ржЬ ржХрж░рж╛ рж╢рзЗржЦрж╛ржи ржПржХржжржо ржкрзНрж░рж╛ржержорж┐ржХ ржерзЗржХрзЗ ржзрж╛ржкрзЗ-ржзрж╛ржкрзЗ рж╢рзЗрж╖ ржкрж░рзНржпржирзНрждред ржпрзЗржЦрж╛ржирзЗ k3s ржПрж░ ржмрзНржпржмрж╣рж╛рж░ ржзрж╛ржкрзЗ-ржзрж╛ржкрзЗ k3s ржПрж░ ржпрзЗрж╕ржХрж▓ ржмрж┐рж╖рзЯ ржЖржЫрзЗ рж╕ржм ржХрж┐ржЫрзБ ржПржХржжржо ржзрж╛рж░рж╛ржмрж╛рж╣рж┐ржХржнрж╛ржмрзЗ ржзрж╛ржкрзЗ-ржзрж╛ржкрзЗ ржкрзНрж░рж╛ржХрзНржЯрж┐ржХрзНржпрж╛рж▓ рж╢рзЗржЦрж╛ржмрзЗржиред 


### ASSISTANT
ржЕрж╕рж╛ржзрж╛рж░ржг! ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ **ржкрзНрж░рж╛ржержорж┐ржХ ржерзЗржХрзЗ рж╢рзЗрж╖ ржкрж░рзНржпржирзНржд тАФ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ, ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓рж┐, k3s-ржПрж░ ржкрзБрж░рзЛ рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓** рж╢рж┐ржЦрждрзЗ ржЪрж╛ржи, рж╕рзЗржЬржирзНржп ржЖржорж┐ ржЖржкржирж╛ржХрзЗ **ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг рж╣рзНржпрж╛ржирзНржбрж╕-ржЕржи рж▓рж╛рж░рзНржирж┐ржВ рж░рзЛржбржорзНржпрж╛ржк** ржжрж┐ржЪрзНржЫрж┐ тАФ ржпрж╛ рж╢рзБржзрзБ ржерж┐ржУрж░рж┐ ржиржпрж╝, ржмрж░ржВ **ржкрзНрж░рждрж┐ржЯрж┐ ржзрж╛ржкрзЗ ржЖржкржирж┐ ржирж┐ржЬрзЗ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж┐ржпрж╝рзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрж┐рж▓рзНржб ржХрж░ржмрзЗржи**ред

ржПржЗ ржЧрж╛ржЗржбржЯрж┐ ржЖржкржирж╛рж░ **8+ ржмржЫрж░рзЗрж░ DevOps ржЕржнрж┐ржЬрзНржЮрждрж╛**, **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗрж░ ржХржиржЯрзЗржХрзНрж╕ржЯ**, ржПржмржВ **ржмрж╛ржВрж▓рж╛ржпрж╝ ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╢рзЗржЦрж╛ржирзЛрж░ ржжржХрзНрж╖рждрж╛**-ржХрзЗ ржорж╛ржерж╛ржпрж╝ рж░рзЗржЦрзЗ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред

---

# ЁЯМ▒ **k3s рж╢рзЗржЦрж╛: ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржЧрж╛ржЗржб (ржкрзНрж░рж╛ржержорж┐ржХ ржерзЗржХрзЗ ржЕрзНржпрж╛ржбржнрж╛ржирзНрж╕ржб)**  
> **рж▓ржХрзНрж╖рзНржп**: ржПржХржЬржи ржбрзЗржнржУржкрж╕ ржЗржЮрзНржЬрж┐ржирж┐ржпрж╝рж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ k3s-ржПрж░ ржкрзНрж░рждрж┐ржЯрж┐ рж▓рзЗржпрж╝рж╛рж░ рж╣рж╛рждрзЗ-ржХрж▓ржорзЗ ржорж╛рж╕рзНржЯрж╛рж░ ржХрж░рж╛

---

## ЁЯФ╣ **ржзрж╛ржк рзз: k3s ржЗржирж╕рзНржЯрж▓ тАФ ржПржмржВ ржХрзА рж╣ржпрж╝ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ ржкрж░?**

### тЬЕ ржХрж╛ржЬ:
```bash
# ржХрзНрж▓рж┐ржи рж╕рж╛рж░рзНржнрж╛рж░рзЗ (Ubuntu/Debian) ржЗржирж╕рзНржЯрж▓
curl -sfL https://get.k3s.io | sh -
```

### ЁЯФН ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи:
```bash
systemctl status k3s             # рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж▓ржЫрзЗ?
kubectl get nodes                # ржирзЛржб Ready?
cat /etc/rancher/k3s/k3s.yaml    # kubeconfig
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
```

### ЁЯУВ ржлрж╛ржЗрж▓ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржЪрзЗржирзБржи:
- `/var/lib/rancher/k3s/` тЖТ ржбрзЗржЯрж╛, ржЯрзЛржХрзЗржи, рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ
- `/etc/rancher/k3s/` тЖТ ржХржиржлрж┐ржЧ
- `/usr/local/bin/k3s` тЖТ ржмрж╛ржЗржирж╛рж░рж┐

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: ржирждрзБржи ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржорзЗрж╢рж┐ржирзЗ k3s ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи ржПржмржВ ржЙржкрж░рзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ ржЪрж╛рж▓рж╛ржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзи: kubectl ржжрж┐ржпрж╝рзЗ ржкрзНрж░ржержо Pod ржЪрж╛рж▓рж╛ржирзЛ**

### тЬЕ ржХрж╛ржЬ:
```bash
# ржПржХржЯрж┐ рж╕рж╛ржжрж╛ржорж╛ржЯрж╛ nginx pod
kubectl run my-nginx --image=nginx --port=80

# ржкржб ржЪрзЗржХ
kubectl get pods

# ржкржб ржбрж┐рж▓рж┐ржЯ
kubectl delete pod my-nginx
```

### ЁЯУМ рж╢рж┐ржЦрзБржи:
- Pod ржХрзА?
- `kubectl run` vs `kubectl apply -f`
- `kubectl describe pod <name>` тЖТ ржЗржнрзЗржирзНржЯ ржжрзЗржЦрзБржи

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: Alpine, busybox, nginx тАФ рждрж┐ржиржЯрж┐ ржЖрж▓рж╛ржжрж╛ ржкржб ржЪрж╛рж▓рж╛ржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзй: Deployment, Service, ржПржмржВ рж▓рзЛржХрж╛рж▓ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕**

### тЬЕ ржХрж╛ржЬ:

1. **Deployment ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи** (`nginx-deploy.yaml`):
```yaml
apiVersion: apps/v1
kind: Deployment
meta
  name: nginx-deploy
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    meta
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
```

2. **Apply ржХрж░рзБржи**:
```bash
kubectl apply -f nginx-deploy.yaml
kubectl get deployments
kubectl get pods -l app=nginx
```

3. **Service рждрзИрж░рж┐ ржХрж░рзБржи** (`nginx-svc.yaml`):
```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: ClusterIP  # ржкрж░рзЗ LoadBalancer ржХрж░ржм
```

4. **ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**:
```bash
# ржПржХржЯрж┐ ржЯрзЗржорзНржкрзЛрж░рж╛рж░рж┐ busybox pod ржерзЗржХрзЗ curl
kubectl run -it --rm debug --image=busybox --restart=Never -- sh
/ # wget -O- http://nginx-svc
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: ржПржХржЯрж┐ Python Flask app ржбрзЗржкрзНрж▓ржпрж╝ ржХрж░рзБржи ржПржмржВ Service ржжрж┐ржпрж╝рзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзк: Ingress тАФ ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕**

k3s ржбрж┐ржлрж▓рзНржЯрзЗ **Traefik** ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржирж┐ржпрж╝рзЗ ржЖрж╕рзЗред

### тЬЕ ржХрж╛ржЬ:

1. **Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ рждрзИрж░рж┐** (`nginx-ingress.yaml`):
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
meta
  name: nginx-ingress
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web
spec:
  rules:
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx-svc
            port:
              number: 80
```

2. **Apply ржПржмржВ ржЯрзЗрж╕рзНржЯ**:
```bash
kubectl apply -f nginx-ingress.yaml
curl http://<YOUR_SERVER_IP>  # ржХрж╛ржЬ ржХрж░ржмрзЗ!
```

> тЪая╕П **ржирзЛржЯ**: рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓рзЗ 80 ржкрзЛрж░рзНржЯ ржЦрзЛрж▓рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржиред

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: ржжрзБржЯрж┐ ржЕрзНржпрж╛ржк (nginx + httpd) ржбрзЗржкрзНрж▓ржпрж╝ ржХрж░рзБржи ржПржмржВ ржЖрж▓рж╛ржжрж╛ ржкрж╛рже (`/nginx`, `/httpd`) ржжрж┐ржпрж╝рзЗ Ingress ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзл: Persistent Storage тАФ Local Path (k3s default)**

k3s ржбрж┐ржлрж▓рзНржЯрзЗ `local-path-provisioner` ржЪрж╛рж▓рзБ ржХрж░рзЗред

### тЬЕ ржХрж╛ржЬ: MySQL ржбрзЗржЯрж╛ ржкрж╛рж░рзНрж╕рж┐рж╕рзНржЯрзЗржирзНржЯ ржХрж░рзБржи

1. **PersistentVolumeClaim (PVC)**:
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
```

2. **MySQL Deployment with PVC**:
```yaml
apiVersion: apps/v1
kind: Deployment
meta
  name: mysql
spec:
  selector:
    matchLabels:
      app: mysql
  template:
    meta
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "password123"
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-storage
          mountPath: /var/lib/mysql
      volumes:
      - name: mysql-storage
        persistentVolumeClaim:
          claimName: mysql-pvc
```

3. **ржЯрзЗрж╕рзНржЯ**:
```bash
kubectl apply -f mysql-pvc.yaml -f mysql-deploy.yaml
# ржкржб ржбрж┐рж▓рж┐ржЯ ржХрж░рзБржи тЖТ ржбрзЗржЯрж╛ ржерж╛ржХржмрзЗ!
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: WordPress + MySQL рж╕рзНржЯрзНржпрж╛ржХ ржбрзЗржкрзНрж▓ржпрж╝ ржХрж░рзБржи (PVC рж╕рж╣)ред

---

## ЁЯФ╣ **ржзрж╛ржк рзм: Namespace, RBAC, ржПржмржВ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐**

### тЬЕ ржХрж╛ржЬ:
1. ржирждрзБржи namespace рждрзИрж░рж┐
2. рж╕рзАржорж┐ржд ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржжрзЗржУржпрж╝рж╛рж░ ржЬржирзНржп ServiceAccount + RoleBinding

```yaml
# dev-ns.yaml
apiVersion: v1
kind: Namespace
meta
  name: dev

# dev-sa.yaml
apiVersion: v1
kind: ServiceAccount
meta
  name: dev-user
  namespace: dev

# dev-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
meta
  namespace: dev
  name: dev-role
rules:
- apiGroups: [""]  # core API
  resources: ["pods", "services"]
  verbs: ["get", "list", "create"]

# dev-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
meta
  name: dev-rb
  namespace: dev
subjects:
- kind: ServiceAccount
  name: dev-user
  namespace: dev
roleRef:
  kind: Role
  name: dev-role
  apiGroup: rbac.authorization.k8s.io
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: `kubectl --as=system:serviceaccount:dev:dev-user -n dev get pods` ржЪрж╛рж▓рж┐ржпрж╝рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзн: ржоржирж┐ржЯрж░рж┐ржВ тАФ Metrics Server + k9s**

k3s ржбрж┐ржлрж▓рзНржЯрзЗ Metrics Server ржЖржирзЗред

### тЬЕ ржХрж╛ржЬ:
```bash
kubectl top nodes
kubectl top pods
```

ржЗржирж╕рзНржЯрж▓ **k9s** (terminal UI):
```bash
curl -sS https://webinstall.dev/k9s | bash
k9s  # GUI-like terminal
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: ржПржХржЯрж┐ CPU-intensive pod ржЪрж╛рж▓рж╛ржи ржПржмржВ `kubectl top` ржжрж┐ржпрж╝рзЗ ржоржирж┐ржЯрж░ ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзо: ржЖржкржЧрзНрж░рзЗржб ржУ ржЖржиржЗржирж╕рзНржЯрж▓**

### тЬЕ ржЖржкржЧрзНрж░рзЗржб:
```bash
# ржирждрзБржи ржнрж╛рж░рзНрж╕ржирзЗ
curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=v1.34.0+k3s1 sh -
```

### тЬЕ ржЖржиржЗржирж╕рзНржЯрж▓:
```bash
/usr/local/bin/k3s-uninstall.sh
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: v1.33 тЖТ v1.34-ржП ржЖржкржЧрзНрж░рзЗржб ржХрж░рзБржи ржПржмржВ ржкржбржЧрзБрж▓рзЛ ржЪрзЗржХ ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рзп: Multi-node Cluster (Worker ржпрзЛржЧ ржХрж░рзБржи)**

1. Master-ржП ржЯрзЛржХрзЗржи ржкрж╛ржи:
   ```bash
   cat /var/lib/rancher/k3s/server/node-token
   ```

2. Worker ржорзЗрж╢рж┐ржирзЗ:
   ```bash
   curl -sfL https://get.k3s.io | K3S_URL=https://<MASTER_IP>:6443 K3S_TOKEN="<TOKEN>" sh -
   ```

3. Master-ржП ржЪрзЗржХ:
   ```bash
   kubectl get nodes  # 2 nodes ржжрзЗржЦрж╛ржмрзЗ
   ```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: 1 master + 2 worker рж╕рзЗржЯржЖржк ржХрж░рзБржиред

---

## ЁЯФ╣ **ржзрж╛ржк рззрзж: Helm ржжрж┐ржпрж╝рзЗ ржЕрзНржпрж╛ржк ржбрзЗржкрзНрж▓ржпрж╝ (k3s-ржПрж░ built-in Helm)**

k3s-ржП Helm controller ржЖржЫрзЗред

### тЬЕ ржХрж╛ржЬ:
```bash
# Prometheus install
kubectl apply -f https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/main/bundle.yaml

# ржЕржержмрж╛ Helm CLI (install separately)
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install my-prometheus prometheus-community/prometheus
```

> ЁЯТб **ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕**: `ingress-nginx` (Traefik ржмржирзНржз ржХрж░рзЗ) Helm ржжрж┐ржпрж╝рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржиред

---

# тЬЕ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк: ржЖржкржирж┐ ржПржЦржи ржкрж░рзНржпржирзНржд ржпрж╛ рж╢рж┐ржЦржмрзЗржи

| ржзрж╛ржк | ржХрзА рж╢рж┐ржЦржмрзЗржи | рж░рж┐ржпрж╝рзЗрж▓-ржУржпрж╝рж╛рж░рзНрж▓рзНржб ржкрзНрж░ржпрж╝рзЛржЧ |
|-----|------------|------------------|
| 1 | k3s install & verify | рж╣рзЛржо рж▓рзНржпрж╛ржм рж╕рзЗржЯржЖржк |
| 2 | Pod lifecycle | ржХржирзНржЯрзЗржЗржирж╛рж░ ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ |
| 3 | Deployment + Service | ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ |
| 4 | Ingress (Traefik) | ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржк ржкрж╛ржмрж▓рж┐ржХ ржХрж░рж╛ |
| 5 | Persistent Storage | ржбрзЗржЯрж╛ржмрзЗрж╕, ржлрж╛ржЗрж▓ рж╕рзНржЯрзЛрж░рзЗржЬ |
| 6 | RBAC + Namespace | ржЯрж┐ржо-ржнрж┐рждрзНрждрж┐ржХ ржЖржЗрж╕рзЛрж▓рзЗрж╢ржи |
| 7 | Monitoring | ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи |
| 8 | Upgrade/Uninstall | ржорзЗржЗржиржЯрзЗржирзЗржирзНрж╕ |
| 9 | Multi-node | рж╕рзНржХрзЗрж▓рж┐ржВ |
| 10 | Helm | ржЕрзНржпрж╛ржк ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ |

---

# ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржкрж░рзНржмрзЗ ржЖржорж░рж╛ ржХржнрж╛рж░ ржХрж░ржм:

1. тЬЕ **k3s-ржП Longhorn + Cilium + MetalLB** тЖТ production-grade networking & storage  
2. тЬЕ **k3s + FluxCD + SOPS + GitHub** тЖТ fully automated GitOps cluster  

ржХрж┐ржирзНрждрзБ ржПржЦржи тАФ **ржЖржкржирж┐ ржкрзНрж░ржержорзЗ ржЙржкрж░рзЗрж░ 10ржЯрж┐ ржзрж╛ржк рж╣рж╛рждрзЗ-ржХрж▓ржорзЗ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ ржХрж░рзБржи**ред  
ржкрзНрж░рждрж┐ржЯрж┐ ржзрж╛ржкрзЗрж░ ржкрж░ ржЖржкржирж┐ ржпржжрж┐ **"Done!"** ржЬрж╛ржирж╛ржи, ржЖржорж┐ ржкрж░рзЗрж░ ржзрж╛ржкрзЗрж░ ржбрж┐ржЯрзЗржЗрж▓рж╕ ржмрж╛ ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржжрзЗржмред

ржЖржкржирж┐ ржХрзЛржи ржзрж╛ржкрзЗ ржЖржЫрзЗржи? ржирж╛ржХрж┐ рж╕ржмржЧрзБрж▓рзЛ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ ржХрж░рзЗ ржлрзЗрж▓рзЗржЫрзЗржи? ЁЯШК

### USER
root@k8sworker:~/kube-text# kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.43.0.1       <none>        443/TCP   22h
nginx-svc    ClusterIP   10.43.192.174   <none>        80/TCP    20m
root@k8sworker:~/kube-text# kubectl get ingress
NAME            CLASS    HOSTS   ADDRESS   PORTS   AGE
nginx-ingress   <none>   *                 80      18m
root@k8sworker:~/kube-text# curl http://192.168.0.38
curl: (7) Failed to connect to 192.168.0.38 port 80 after 0 ms: Couldn't connect to server
root@k8sworker:~/kube-text# curl http://10.43.192.174
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
root@k8sworker:~/kube-text# 

### ASSISTANT
ржзржирзНржпржмрж╛ржж ржЖржкржирж╛рж░ ржЖржЙржЯржкрзБржЯржЧрзБрж▓рзЛ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп!  
ржЖржкржирж┐ ржкрзНрж░рж╛ржпрж╝ рж╕ржмржХрж┐ржЫрзБ **ржарж┐ржХржарж╛ржХржнрж╛ржмрзЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзЗржЫрзЗржи** тАФ рж╢рзБржзрзБ ржПржХржЯрж┐ ржЫрзЛржЯ ржХрж┐ржирзНрждрзБ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржмрж┐рж╖ржпрж╝рзЗ ржЖржЯржХрзЗ ржЧрзЗржЫрзЗржи: **Ingress Controller (Traefik) ржмрж╛ржЗрж░рзЗрж░ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХрзЗ 80 ржкрзЛрж░рзНржЯрзЗ рж╢рзЛржиржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛**ред

---

## ЁЯФН рж╕ржорж╕рзНржпрж╛рж░ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

ржЖржкржирж╛рж░ ржЖржЙржЯржкрзБржЯ ржерзЗржХрзЗ ржкрж░рж┐рж╖рзНржХрж╛рж░:

- тЬЕ **Service (`nginx-svc`)** ржХрж╛ржЬ ржХрж░ржЫрзЗ тЖТ `curl http://10.43.192.174` ржХрж╛ржЬ ржХрж░рзЗржЫрзЗред
- тЬЕ **Ingress рж░рж┐рж╕рзЛрж░рзНрж╕** рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ тЖТ `kubectl get ingress`-ржП ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗред
- тЭМ **ржХрж┐ржирзНрждрзБ `curl http://192.168.0.38` (ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░ IP) 80 ржкрзЛрж░рзНржЯрзЗ рж░рзЗрж╕ржкржирзНрж╕ ржжрж┐ржЪрзНржЫрзЗ ржирж╛**ред

### рж╕ржорзНржнрж╛ржмрзНржп ржХрж╛рж░ржг:
1. **Traefik ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржЪрж╛рж▓рзБ ржЖржЫрзЗ ржХрж┐ржирж╛?**
2. **Traefik 80/443 ржкрзЛрж░рзНржЯрзЗ ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп (HostNetwork or LoadBalancer)?**
3. **ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓/ufw 80 ржкрзЛрж░рзНржЯ ржмрзНрж▓ржХ ржХрж░ржЫрзЗ?**

---

## тЬЕ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж╕ржорж╛ржзрж╛ржи

### ЁЯФ╣ ржзрж╛ржк рзз: Traefik ржкржб ржЪрзЗржХ ржХрж░рзБржи

```bash
kubectl get pods -n kube-system | grep traefik
```

ржЖржЙржЯржкрзБржЯ ржпржжрж┐ ржжрзЗржЦрж╛ржпрж╝ (ржпрзЗржоржи):
```
svclb-traefik-xxxxx        2/2     Running   0          22h
traefik-xxxxxxxxxx-xxxxx   1/1     Running   0          22h
```
тЖТ рждрж╛рж╣рж▓рзЗ Traefik ржЪрж╛рж▓рзБ ржЖржЫрзЗред

> тЪая╕П ржпржжрж┐ **ржирж╛ ржерж╛ржХрзЗ**, рждрж╛рж╣рж▓рзЗ k3s ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗ Traefik ржбрж┐рж╕рзЗржмрж▓ рж╣ржпрж╝рзЗ ржЧрзЗржЫрзЗред  
> ржХрж┐ржирзНрждрзБ ржЖржкржирж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржЗржиржЧрзНрж░рзЗрж╕ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ, рждрж╛ржЗ рж╕ржорзНржнржмржд ржЖржЫрзЗред

---

### ЁЯФ╣ ржзрж╛ржк рзи: Traefik ржХрзЛржи ржкрзЛрж░рзНржЯрзЗ рж╢рзЛржиржЫрзЗ?

k3s-ржП Traefik **`HostPort`** ржмрж╛ **`LoadBalancer`** рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓рзЗред  
ржлрж▓рзЗ ржПржЯрж┐ рж╕рж░рж╛рж╕рж░рж┐ **рж╣рзЛрж╕рзНржЯрзЗрж░ 80/443 ржкрзЛрж░рзНржЯ** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред

ржЪрзЗржХ ржХрж░рзБржи:
```bash
sudo ss -tulnp | grep ':80'
```

ржЖржЙржЯржкрзБржЯ ржпржжрж┐ ржжрзЗржЦрж╛ржпрж╝:
```
tcp  LISTEN 0 128 *:80 *:* users:(("k3s-server",pid=...,fd=...))
```
тЖТ рждрж╛рж╣рж▓рзЗ 80 ржкрзЛрж░рзНржЯ ржЦрзЛрж▓рж╛ ржЖржЫрзЗред

ржпржжрж┐ **ржХрж┐ржЫрзБ ржирж╛ ржжрзЗржЦрж╛ржпрж╝**, рждрж╛рж╣рж▓рзЗ Traefik рж╣рзЛрж╕рзНржЯ ржкрзЛрж░рзНржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ ржирж╛ред

---

### ЁЯФ╣ ржзрж╛ржк рзй: k3s ржХржиржлрж┐ржЧ ржЪрзЗржХ тАФ Traefik ржбрж┐рж╕рзЗржмрж▓ рждрзЛ ржиржпрж╝?

Traefik ржбрж┐ржлрж▓рзНржЯрзЗ ржЪрж╛рж▓рзБ ржерж╛ржХрзЗ, ржХрж┐ржирзНрждрзБ ржпржжрж┐ ржЖржкржирж┐ ржЗржирж╕рзНржЯрж▓ рж╕ржоржпрж╝ `--disable traefik` ржжрж┐ржпрж╝рзЗ ржерж╛ржХрзЗржи, рждрж╛рж╣рж▓рзЗ ржЗржиржЧрзНрж░рзЗрж╕ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛ред

ржЪрзЗржХ ржХрж░рзБржи:
```bash
ps aux | grep k3s
```

ржЖржЙржЯржкрзБржЯрзЗ ржпржжрж┐ ржжрзЗржЦрзЗржи:
```
k3s server --disable traefik ...
```
тЖТ рждрж╛рж╣рж▓рзЗ Traefik ржмржирзНржзред

**рж╕ржорж╛ржзрж╛ржи**:  
Traefik ржЪрж╛рж▓рзБ ржХрж░рждрзЗ рж╣ржмрзЗ тАФ ржЕржержмрж╛ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ рж╣ржмрзЗред  
ржХрж┐ржирзНрждрзБ рж╕рж╣ржЬ ржЙржкрж╛ржпрж╝: **k3s рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржирж╛ ржХрж░рзЗ ржирж┐ржЪрзЗрж░ ржзрж╛ржкрзЗ ржпрж╛ржи**ред

---

### ЁЯФ╣ ржзрж╛ржк рзк: `LoadBalancer` Service рж╣рж┐рж╕рзЗржмрзЗ Traefik ржЪрзЗржХ ржХрж░рзБржи

k3s-ржП Traefik ржПржХржЯрж┐ `LoadBalancer` ржЯрж╛ржЗржкрзЗрж░ рж╕рж╛рж░рзНржнрж┐рж╕ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓рзЗ:

```bash
kubectl get svc -n kube-system
```

ржЖржЙржЯржкрзБржЯрзЗ ржЦрзБржБржЬрзБржи:
```
NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)
traefik              LoadBalancer   10.43.xxx.xxx   192.168.0.38    80:xxxxx/TCP,443:xxxxx/TCP
```

> ЁЯУМ **ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг**: `EXTERNAL-IP` ржпржжрж┐ **ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░ IP (`192.168.0.38`)** ржжрзЗржЦрж╛ржпрж╝ тАФ рждрж╛рж╣рж▓рзЗ рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХред  
> ржХрж┐ржирзНрждрзБ ржпржжрж┐ `<pending>` ржжрзЗржЦрж╛ржпрж╝ тАФ рждрж╛рж╣рж▓рзЗ **MetalLB ржирж╛ ржерж╛ржХрж╛рж░ ржХрж╛рж░ржгрзЗ** External IP ржЖрж╕ржЫрзЗ ржирж╛!

### тЭЧ ржПржЦрж╛ржирзЗржЗ ржЖржкржирж╛рж░ рж╕ржорж╕рзНржпрж╛рж░ ржорзВрж▓ ржХрж╛рж░ржг!

> ЁЯЪи **k3s-ржПрж░ ржбрж┐ржлрж▓рзНржЯ Traefik `LoadBalancer` рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржЬржирзНржп MetalLB рж▓рж╛ржЧрзЗ** тАФ ржирж╛ рж╣рж▓рзЗ `EXTERNAL-IP` `<pending>` ржерж╛ржХрзЗ, ржПржмржВ **рж╣рзЛрж╕рзНржЯрзЗрж░ 80 ржкрзЛрж░рзНржЯ рж╢рзЛржирзЗ ржирж╛**ред

ржХрж┐ржирзНрждрзБ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи! k3s-ржПрж░ ржЖрж░рзЗржХржЯрж┐ ржорзЛржб ржЖржЫрзЗ: **HostPort ржорзЛржб**ред

---

### ЁЯФ╣ ржзрж╛ржк рзл: рж╕рж╣ржЬ рж╕ржорж╛ржзрж╛ржи тАФ Traefik ржХрзЗ HostPort-ржП ржЪрж╛рж▓рж╛ржирзЛ

k3s-ржП Traefik **ржбрж┐ржлрж▓рзНржЯрзЗ HostPort ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржирж╛** тАФ ржХрж┐ржирзНрждрзБ ржЖржорж░рж╛ ржПржЯрж┐ ржЪрж╛рж▓рзБ ржХрж░рждрзЗ ржкрж╛рж░рж┐ ржирж╛ред  
**ржмрж┐ржХрж▓рзНржк**: ржЖржорж░рж╛ **Ingress ржЫрж╛ржбрж╝рж╛ржЗ рж╕рж░рж╛рж╕рж░рж┐ `NodePort` ржмрж╛ `HostPort`** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ **Ingress рж╢рж┐ржЦрждрзЗ ржЪрж╛ржи**, рждрж╛ржЗ рж╕ржарж┐ржХ ржкрже рж╣рж▓рзЛ:

> тЬЕ **MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи** тЖТ рждрж╛рж╣рж▓рзЗ Traefik-ржПрж░ LoadBalancer рж╕рж╛рж░рзНржнрж┐рж╕ `EXTERNAL-IP` ржкрж╛ржмрзЗ тЖТ 80 ржкрзЛрж░рзНржЯ ржХрж╛ржЬ ржХрж░ржмрзЗред

---

## ЁЯЫая╕П ржЕрж╕рзНржерж╛ржпрж╝рзА ржХрж╛ржЬрзЗрж░ ржЙржкрж╛ржпрж╝ (MetalLB ржЫрж╛ржбрж╝рж╛ржЗ)

ржЖржкржирж┐ ржпржжрж┐ **MetalLB ржЫрж╛ржбрж╝рж╛ржЗ ржЗржиржЧрзНрж░рзЗрж╕ ржЯрзЗрж╕рзНржЯ ржХрж░рждрзЗ ржЪрж╛ржи**, рждрж╛рж╣рж▓рзЗ **Traefik-ржПрж░ ржкржбрзЗрж░ рж▓ржЧ ржЪрзЗржХ ржХрж░рзБржи**:

```bash
kubectl logs -n kube-system -l app.kubernetes.io/name=traefik
```

ржЖрж░ржУ ржнрж╛рж▓рзЛ ржЙржкрж╛ржпрж╝: **рж╕рж░рж╛рж╕рж░рж┐ Traefik-ржПрж░ ржкржбрзЗ curl ржХрж░рзБржи**:

```bash
# Traefik pod ржЦрзБржБржЬрзБржи
TRAEFIK_POD=$(kubectl get pod -n kube-system -l app.kubernetes.io/name=traefik -o jsonpath='{.items[0].metadata.name}')

# рждрж╛рж░ ржнрж┐рждрж░рзЗ curl ржХрж░рзБржи
kubectl exec -n kube-system $TRAEFIK_POD -- wget -qO- http://localhost
```

ржХрж┐ржирзНрждрзБ ржПржЯрж┐ рж╢рзБржзрзБ ржнрзЗрждрж░рзЗ ржерзЗржХрзЗ ржЯрзЗрж╕рзНржЯред

---

## тЬЕ рж╕рзНржерж╛ржпрж╝рзА рж╕ржорж╛ржзрж╛ржи: MetalLB ржЗржирж╕рзНржЯрж▓ (ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗрж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБрждрж┐)

ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ ржмрж▓рзЗржЫрзЗржи ржпрзЗ ржкрж░рзЗ **MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░ржмрзЗржи**, рждрж╛ржЗ ржПржЦржиржЗ рж╢рзБрж░рзБ ржХрж░рзБржи:

### MetalLB ржЗржирж╕рзНржЯрж▓ (Layer 2 mode):

```bash
kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.14.11/config/manifests/metallb-native.yaml

# ржУржпрж╝рзЗржЯ ржХрж░рзБржи
kubectl wait --namespace metallb-system \
                --for=condition=ready pod \
                --selector=app=metallb \
                --timeout=90s
```

### рждрж╛рж░ржкрж░ IP Pool ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи (`metallb-ip-pool.yaml`):

```yaml
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
meta
  name: home-lab-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.0.50-192.168.0.70  # ржЖржкржирж╛рж░ рж▓рзЛржХрж╛рж▓ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХрзЗрж░ ржлрзНрж░рж┐ IP рж░рзЗржЮрзНржЬ
---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
meta
  name: home-lab-l2
  namespace: metallb-system
spec:
  ipAddressPools:
  - home-lab-pool
```

```bash
kubectl apply -f metallb-ip-pool.yaml
```

### ржПржЦржи Traefik рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрзЗржХ ржХрж░рзБржи:

```bash
kubectl get svc -n kube-system traefik
```

ржПржмрж╛рж░ `EXTERNAL-IP` ржкрж╛ржмрзЗржи (ржпрзЗржоржи: `192.168.0.50`) тЖТ рж╕рзЗржЗ IP-рждрзЗ `curl http://192.168.0.50` ржХрж░рзБржиред

> ЁЯТб ржЕржержмрж╛, ржЖржкржирж┐ **Ingress-ржПрж░ `HOSTS` ржПржмржВ DNS** рж╕рзЗржЯ ржХрж░рзЗ **`192.168.0.38`-ржП рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ рж░рж╛ржЙржЯ** ржХрж░рждрзЗ ржкрж╛рж░рзЗржи тАФ ржХрж┐ржирзНрждрзБ MetalLB рж╣рж▓рзЛ "production-grade home cloud"-ржПрж░ ржЬржирзНржп рж╕ржарж┐ржХ ржкржеред

---

## ЁЯФЪ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

| рж╕ржорж╕рзНржпрж╛ | ржХрж╛рж░ржг | рж╕ржорж╛ржзрж╛ржи |
|--------|------|--------|
| `curl http://192.168.0.38` ржХрж╛ржЬ ржХрж░ржЫрзЗ ржирж╛ | Traefik `LoadBalancer` рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ `EXTERNAL-IP` pending | **MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи** |
| Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ ржЖржЫрзЗ ржХрж┐ржирзНрждрзБ ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ | k3s-ржП LoadBalancer-ржПрж░ ржЬржирзНржп MetalLB рж▓рж╛ржЧрзЗ | IP Pool ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи |

---

## тЬЕ ржЖржкржирж╛рж░ ржкрж░ржмрж░рзНрждрзА ржХрж╛ржЬ

1. **MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи** (ржЙржкрж░рзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ ржЪрж╛рж▓рж╛ржи)
2. **Traefik рж╕рж╛рж░рзНржнрж┐рж╕рзЗ `EXTERNAL-IP` ржЖрж╕рж╛ ржкрж░рзНржпржирзНржд ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи**
3. **рж╕рзЗржЗ IP-рждрзЗ `curl` ржХрж░рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**

ржпржЦржи рж╕ржлрж▓ рж╣ржмрзЗржи, ржЬрж╛ржирж╛ржмрзЗржи тАФ рждржЦржи ржЖржорж░рж╛ **Longhorn + Cilium + MetalLB** ржирж┐ржпрж╝рзЗ ржкрзБрж░рзЛ production-grade рж╕рзЗржЯржЖржк рж╢рзБрж░рзБ ржХрж░ржмред

ржЖрж░ ржпржжрж┐ ржПржЦржиржЗ **Ingress ржЫрж╛ржбрж╝рж╛ ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕** ржжрж░ржХрж╛рж░ рж╣ржпрж╝, рждрж╛рж╣рж▓рзЗ ржЖржорж┐ `NodePort` ржмрж╛ `hostNetwork` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕрж╕рзНржерж╛ржпрж╝рзА рж╕ржорж╛ржзрж╛ржи ржжрж┐рждрзЗ ржкрж╛рж░рж┐ред

ржЖржкржирж┐ ржХрзА ржкржЫржирзНржж ржХрж░ржмрзЗржи? ЁЯЫая╕П

### USER
root@k8sworker:~/kube-text# kubectl get pods -n kube-system | grep traefik
root@k8sworker:~/kube-text# sudo ss -tulnp | grep ':80'
root@k8sworker:~/kube-text# ps aux | grep k3s
root       85879 11.5  5.8 1703432 471816 ?      Ssl  Nov25 154:31 /usr/local/bin/k3s server
root       86677  0.0  0.2 1239836 16624 ?       Sl   Nov25   1:01 /var/lib/rancher/k3s/data/86a616cdaf0fb57fa13670ac5a16f1699f4b2be4772e842d97904c69698ffdc2/bin/containerd-shim-runc-v2 -namespace k8s.io -id 7be8c087bcfd47c025030f95a359c5dd53d31a6842bd3573e0a0e84038f71096 -address /run/k3s/containerd/containerd.sock
root       86721  0.0  0.2 1239836 16724 ?       Sl   Nov25   1:02 /var/lib/rancher/k3s/data/86a616cdaf0fb57fa13670ac5a16f1699f4b2be4772e842d97904c69698ffdc2/bin/containerd-shim-runc-v2 -namespace k8s.io -id 7c8834ca6210210bab1c08e219986903f91a897afb3034c71cf8ff529927d15f -address /run/k3s/containerd/containerd.sock
root       86767  0.0  0.2 1240092 16536 ?       Sl   Nov25   1:01 /var/lib/rancher/k3s/data/86a616cdaf0fb57fa13670ac5a16f1699f4b2be4772e842d97904c69698ffdc2/bin/containerd-shim-runc-v2 -namespace k8s.io -id ecfec24f8717a3dc5e9b35f5d0379466c749b9abf7d65b48f2ae1d796659f978 -address /run/k3s/containerd/containerd.sock
root      541775  0.0  0.2 1239836 16476 ?       Sl   15:34   0:01 /var/lib/rancher/k3s/data/86a616cdaf0fb57fa13670ac5a16f1699f4b2be4772e842d97904c69698ffdc2/bin/containerd-shim-runc-v2 -namespace k8s.io -id cd1800c696a927846f20af287353f3fbe16a729ed96f843c69affa0b90646828 -address /run/k3s/containerd/containerd.sock
root      541812  0.0  0.2 1239836 16340 ?       Sl   15:34   0:01 /var/lib/rancher/k3s/data/86a616cdaf0fb57fa13670ac5a16f1699f4b2be4772e842d97904c69698ffdc2/bin/containerd-shim-runc-v2 -namespace k8s.io -id cda224a67449dc819f0a7f0ae625c1d51ea30e4386a7d74a2e993b2f656fbc75 -address /run/k3s/containerd/containerd.sock
root      551246  0.0  0.0   6544  2304 pts/1    S+   16:00   0:00 grep --color=auto k3s
root@k8sworker:~/kube-text# kubectl get svc -n kube-system
NAME             TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                  AGE
kube-dns         ClusterIP   10.43.0.10    <none>        53/UDP,53/TCP,9153/TCP   22h
metrics-server   ClusterIP   10.43.2.162   <none>        443/TCP                  22h
root@k8sworker:~/kube-text#

### ASSISTANT
ржзржирзНржпржмрж╛ржж ржЖржЙржЯржкрзБржЯржЧрзБрж▓рзЛ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп тАФ ржПржЦржи рж╕ржорж╕рзНржпрж╛ржЯрж┐ **ржкрзБрж░рзЛржкрзБрж░рж┐ ржХрзНрж▓рж┐ржпрж╝рж╛рж░**ред

---

## ЁЯФН рж╕ржорж╕рзНржпрж╛рж░ ржорзВрж▓ ржХрж╛рж░ржг

ржЖржкржирж╛рж░ k3s ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ **Traefik ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржирзЗржЗ**ред

ржкрзНрж░ржорж╛ржг:
- `kubectl get pods -n kube-system | grep traefik` тЖТ **ржХрзЛржирзЛ ржЖржЙржЯржкрзБржЯ ржирзЗржЗ**
- `kubectl get svc -n kube-system` тЖТ **рж╢рзБржзрзБ `kube-dns` ржПржмржВ `metrics-server`**, Traefik ржирзЗржЗ
- `ss -tulnp | grep ':80'` тЖТ **80 ржкрзЛрж░рзНржЯрзЗ ржХрж┐ржЫрзБ рж╢рзЛржиржЫрзЗ ржирж╛**

### ржХрзАржнрж╛ржмрзЗ ржПржЯрж╛ рж╣рж▓рзЛ?

k3s **ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗ**, ржХрж┐ржирзНрждрзБ ржпржжрж┐ ржЖржкржирж┐ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи рж╕ржоржпрж╝ ржирж┐ржЪрзЗрж░ ржХрзЛржирзЛ ржПржХржЯрж┐ ржХрж░рзЗ ржерж╛ржХрзЗржи:

- `--disable traefik` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрзЗржи,  
- ржЕржержмрж╛ ржкрж░рзЗ `kubectl delete -n kube-system deploy/traefik` ржХрж░рзЗ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗржЫрзЗржи,

рждрж╛рж╣рж▓рзЗ Traefik ржерж╛ржХржмрзЗ ржирж╛ред

> ЁЯУМ **ржЖржкржирж╛рж░ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ Traefik ржирзЗржЗ тЖТ рждрж╛ржЗ Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ рждрзИрж░рж┐ рж╣рж▓рзЗржУ ржХрзЛржирзЛ ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ рждрж╛ ржкрзНрж░рж╕рзЗрж╕ ржХрж░ржЫрзЗ ржирж╛ тЖТ 80 ржкрзЛрж░рзНржЯрзЗ ржХрж┐ржЫрзБ рж░рзЗрж╕ржкржирзНрж╕ ржжрж┐ржЪрзНржЫрзЗ ржирж╛ред**

---

## тЬЕ рж╕ржорж╛ржзрж╛ржи: Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи (ржЕржержмрж╛ ржмрж┐ржХрж▓рзНржк ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░)

ржЖржкржирж╛рж░ **ржжрзБржЯрж┐ ржЕржкрж╢ржи** ржЖржЫрзЗ:

---

### тЬЕ **ржЕржкрж╢ржи рзз: Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи (k3s-ржПрж░ ржбрж┐ржлрж▓рзНржЯ)**

Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐:

```bash
# Traefik Helm chart (k3s-ржПрж░ ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржЙржкрж╛ржпрж╝)
kubectl apply -f https://raw.githubusercontent.com/k3s-io/k3s/master/manifests/traefik.yaml
```

> тЪая╕П ржирзЛржЯ: ржПржЗ ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯржЯрж┐ k3s v1.25+ ржП ржХрж╛ржЬ ржХрж░рзЗред  
> ржЖржкржирж╛рж░ ржнрж╛рж░рзНрж╕ржи: `v1.33.5+k3s1` тЖТ рж╕рж╛ржкрзЛрж░рзНржЯрзЗржбред

ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ ржкрж░ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи:
```bash
kubectl get pods -n kube-system -w | grep traefik
```

рж╕ржлрж▓ рж╣рж▓рзЗ ржжрзЗржЦрж╛ржмрзЗ:
```
traefik-xxxxxxxxxx-xxxxx   1/1     Running   0          30s
```

ржПржмржВ рж╕рж╛рж░рзНржнрж┐рж╕:
```bash
kubectl get svc -n kube-system traefik
```

ржЖржЙржЯржкрзБржЯ рж╣ржмрзЗ:
```
NAME      TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)
traefik   LoadBalancer   10.43.xxx.xxx   <pending>     80:32456/TCP,443:31234/TCP
```

> тЭЧ `EXTERNAL-IP` `<pending>` ржерж╛ржХржмрзЗ тАФ **ржХрж╛рж░ржг MetalLB ржирзЗржЗ**ред  
> ржХрж┐ржирзНрждрзБ Traefik **`NodePort`** рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗред

### ЁЯФ╣ рждржЦржи ржЖржкржирж┐ ржХрзАржнрж╛ржмрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░ржмрзЗржи?

```bash
# NodePort ржЦрзБржБржЬрзБржи
kubectl get svc -n kube-system traefik
# ржЖржЙржЯржкрзБржЯ: 80:32456 тЖТ ржЕрж░рзНрже 32456 рж╣рж▓рзЛ NodePort
```

рждрж╛рж░ржкрж░:
```bash
curl http://192.168.0.38:32456
```

ржПржЯрж┐ ржХрж╛ржЬ ржХрж░ржмрзЗ!

> ЁЯТб **ржкрж░рзЗ MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░рж▓рзЗ `EXTERNAL-IP` ржЖрж╕ржмрзЗ ржПржмржВ 80 ржкрзЛрж░рзНржЯ рж╕рж░рж╛рж╕рж░рж┐ ржХрж╛ржЬ ржХрж░ржмрзЗред**

---

### тЬЕ **ржЕржкрж╢ржи рзи: Nginx Ingress Controller (Helm ржжрж┐ржпрж╝рзЗ)**

ржЖржкржирж┐ ржпржжрж┐ Traefik ржирж╛ ржЪрж╛ржи, Nginx Ingress ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
helm install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx --create-namespace \
  --set controller.hostPort.enabled=true
```

`hostPort.enabled=true` тЖТ рж╕рж░рж╛рж╕рж░рж┐ 80/443 ржкрзЛрж░рзНржЯ рж╢рзЛржиржмрзЗред

рждрж╛рж░ржкрж░:
```bash
curl http://192.168.0.38
```

ржХрж╛ржЬ ржХрж░ржмрзЗред

---

## ЁЯЪА рж╕рзБржкрж╛рж░рж┐рж╢: Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи (Option 1)

ржХрж╛рж░ржг:
- k3s-ржПрж░ рж╕рж╛ржерзЗ ржирзЗржЯрж┐ржн ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи
- ржХржо рж░рж┐рж╕рзЛрж░рзНрж╕ ржмрзНржпржмрж╣рж╛рж░
- ржкрж░рзЗ MetalLB ржпрзЛржЧ ржХрж░рж▓рзЗ ржкрж╛рж░ржлрзЗржХрзНржЯ рж╣ржмрзЗ

### ЁЯУМ ржзрж╛ржкржЧрзБрж▓рзЛ ржПржХ рж▓рж╛ржЗржирзЗ:

```bash
# 1. Traefik ржЗржирж╕рзНржЯрж▓
kubectl apply -f https://raw.githubusercontent.com/k3s-io/k3s/master/manifests/traefik.yaml

# 2. ржУржпрж╝рзЗржЯ ржХрж░рзБржи
kubectl wait -n kube-system --for=condition=ready pod -l app.kubernetes.io/name=traefik --timeout=120s

# 3. NodePort ржЪрзЗржХ ржХрж░рзБржи
NODE_PORT=$(kubectl get svc -n kube-system traefik -o jsonpath='{.spec.ports[?(@.port==80)].nodePort}')

# 4. ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи
curl http://192.168.0.38:$NODE_PORT
```

ржЖржЙржЯржкрзБржЯ рж╣ржмрзЗ:
```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
...
```

тЬЕ **Ingress ржПржЦржи ржХрж╛ржЬ ржХрж░ржмрзЗ!**

---

## ЁЯФЪ ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк

1. **Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи** (ржЙржкрж░рзЗрж░ ржХржорж╛ржирзНржб)
2. **`curl http://192.168.0.38:<NodePort>` ржжрж┐ржпрж╝рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**
3. рж╕ржлрж▓ рж╣рж▓рзЗ ржЬрж╛ржирж╛ржи тАФ рждржЦржи ржЖржорж░рж╛ **MetalLB тЖТ Longhorn тЖТ Cilium** ржзрж╛ржкрзЗ ржпрж╛ржм

> ЁЯТб ржоржирзЗ рж░рж╛ржЦржмрзЗржи: ржПржЦржи ржЖржкржирж┐ **Ingress рж╢рж┐ржЦржЫрзЗржи**, рждрж╛ржЗ Traefik/Nginx **ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░** ржЫрж╛ржбрж╝рж╛ Ingress ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛ тАФ ржПржЯрж╛ Kubernetes-ржПрж░ ржирж┐ржпрж╝ржоред

ржЖржкржирж┐ ржХрзЛржи ржЕржкрж╢ржи ржирж┐ржЪрзНржЫрзЗржи? ЁЯЫая╕П

### USER
root@k8sworker:~/kube-text# kubectl apply -f https://raw.githubusercontent.com/k3s-io/k3s/master/manifests/traefik.yaml  
helmchart.helm.cattle.io/traefik-crd created
helmchart.helm.cattle.io/traefik created
root@k8sworker:~/kube-text# kubectl get pods -n kube-system -w | grep traefik
helm-install-traefik-crd-vlgx5            0/1     ContainerCreating   0          14s
helm-install-traefik-x6ww2                0/1     ContainerCreating   0          14s
helm-install-traefik-crd-vlgx5            1/1     Running             0          44s
helm-install-traefik-x6ww2                1/1     Running             0          44s
helm-install-traefik-crd-vlgx5            0/1     Error               0          48s
helm-install-traefik-x6ww2                0/1     Error               0          48s
helm-install-traefik-crd-vlgx5            1/1     Running             1 (6s ago)   50s
helm-install-traefik-x6ww2                1/1     Running             1 (6s ago)   50s
helm-install-traefik-crd-vlgx5            0/1     Error               1 (8s ago)   52s
helm-install-traefik-x6ww2                0/1     Error               1 (8s ago)   52s



### ASSISTANT
ржЖржкржирж╛рж░ ржЖржЙржЯржкрзБржЯ ржерзЗржХрзЗ рж╕рзНржкрж╖рзНржЯ тАФ **Traefik HelmChart ржХрзНрж░рзНржпрж╛рж╢ ржХрж░ржЫрзЗ**ред  
ржПржЯрж┐ k3s v1.33+ ржПрж░ рж╕рж╛ржерзЗ **Traefik v2 ржПржмржВ Helm v3 API ржнрж╛рж░рзНрж╕ржи ржорж┐рж╕ржорзНржпрж╛ржЪ**-ржПрж░ ржХрж╛рж░ржгрзЗ ржШржЯржЫрзЗред

> тЭМ рж╕ржорж╕рзНржпрж╛:  
> k3s v1.33+ ржПржЦржи **HelmChart.v1** (ржирждрзБржи API) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ, ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ ржпрзЗ ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗржи (`k3s/master/manifests/traefik.yaml`) рж╕рзЗржЯрж┐ **ржкрзБрж░рж╛ржирзЛ HelmChart.v1** ржлрж░ржорзНржпрж╛ржЯрзЗ тАФ ржпрж╛ ржЖрж░ ржХрж╛ржЬ ржХрж░рзЗ ржирж╛ред

---

## тЬЕ рж╕ржарж┐ржХ рж╕ржорж╛ржзрж╛ржи: **Traefik ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ Helm ржжрж┐ржпрж╝рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи**

k3s-ржПрж░ ржмрж┐рж▓рзНржЯ-ржЗржи Helm ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░рзЗрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ, ржЖржорж░рж╛ **рж╕рж░рж╛рж╕рж░рж┐ Helm CLI** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред

### ЁЯФ╣ ржзрж╛ржк рзз: Helm ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи (ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ)

```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

### ЁЯФ╣ ржзрж╛ржк рзи: Traefik Helm Chart ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
# Traefik repo ржпрзЛржЧ ржХрж░рзБржи
helm repo add traefik https://traefik.github.io/charts
helm repo update

# Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи тАФ hostPort рж╕рж╣ (80/443 рж╕рж░рж╛рж╕рж░рж┐ рж╢рзЛржиржмрзЗ)
helm install traefik traefik/traefik \
  --namespace traefik --create-namespace \
  --set ports.web.hostPort=80 \
  --set ports.websecure.hostPort=443 \
  --set service.type=ClusterIP
```

> тЬЕ `hostPort=80` тЖТ Traefik рж╕рж░рж╛рж╕рж░рж┐ рж╣рзЛрж╕рзНржЯрзЗрж░ 80 ржкрзЛрж░рзНржЯ рж╢рзЛржиржмрзЗ  
> тЬЕ `service.type=ClusterIP` тЖТ LoadBalancer рж▓рж╛ржЧржмрзЗ ржирж╛ (MetalLB ржЫрж╛ржбрж╝рж╛ржЗ ржХрж╛ржЬ ржХрж░ржмрзЗ)

---

### ЁЯФ╣ ржзрж╛ржк рзй: ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи

```bash
# ржкржб ржЪрзЗржХ
kubectl get pods -n traefik

# рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрзЗржХ
kubectl get svc -n traefik

# 80 ржкрзЛрж░рзНржЯ рж╢рзЛржиржЫрзЗ ржХрж┐ржирж╛?
sudo ss -tulnp | grep ':80'
```

ржЖржЙржЯржкрзБржЯ рж╣ржмрзЗ:
```
tcp  LISTEN 0 4096 *:80 *:* users:(("traefik",pid=...,fd=...))
```

---

### ЁЯФ╣ ржзрж╛ржк рзк: ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржЖржЧрзЗрж░ Ingress (`nginx-ingress`) ржЗрждрж┐ржоржзрзНржпрзЗ рждрзИрж░рж┐ тАФ рждрж╛ржЗ рж╢рзБржзрзБ curl ржХрж░рзБржи:

```bash
curl http://192.168.0.38
```

тЬЕ ржПржмрж╛рж░ **"Welcome to nginx!"** ржЖрж╕ржмрзЗ!

---

## ЁЯУМ ржХрзЗржи ржПржЯрж┐ ржХрж╛ржЬ ржХрж░ржмрзЗ?

- `hostPort: 80` тЖТ Traefik рж╕рж░рж╛рж╕рж░рж┐ рж╣рзЛрж╕рзНржЯ OS-ржПрж░ 80 ржкрзЛрж░рзНржЯ ржмрж╛ржЗржирзНржб ржХрж░ржмрзЗ
- MetalLB рж▓рж╛ржЧржмрзЗ ржирж╛ (ржЕрж╕рзНржерж╛ржпрж╝рзАржнрж╛ржмрзЗ)
- ржЖржкржирж╛рж░ Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ ржПржЦржи Traefik ржжрзНржмрж╛рж░рж╛ ржкрзНрж░рж╕рзЗрж╕ рж╣ржмрзЗ

---

## ЁЯФБ ржмрж┐ржХрж▓рзНржк: ржпржжрж┐ Helm ржирж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржи

ржЖржкржирж┐ **raw Kubernetes ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯ** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```bash
kubectl apply -f https://raw.githubusercontent.com/traefik/traefik/v2.11/docs/content/reference/dynamic-configuration/kubernetes-crd-definition-v1.yml
kubectl apply -f - <<EOF
apiVersion: v1
kind: Namespace
meta
  name: traefik
---
apiVersion: apps/v1
kind: Deployment
meta
  name: traefik
  namespace: traefik
spec:
  replicas: 1
  selector:
    matchLabels:
      app: traefik
  template:
    meta
      labels:
        app: traefik
    spec:
      containers:
      - name: traefik
        image: traefik:v2.11
        args:
        - --providers.kubernetesingress
        - --entrypoints.web.address=:80
        ports:
        - name: web
          containerPort: 80
          hostPort: 80
---
apiVersion: v1
kind: Service
meta
  name: traefik
  namespace: traefik
spec:
  selector:
    app: traefik
  ports:
  - name: web
    port: 80
    targetPort: 80
EOF
```

ржХрж┐ржирзНрждрзБ **Helm рж╕ржорж╛ржзрж╛ржи ржмрзЗрж╢рж┐ ржорзЗржЗржиржЯрзЗржЗржирзЗржмрж▓**ред

---

## тЬЕ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

| рж╕ржорж╕рзНржпрж╛ | рж╕ржорж╛ржзрж╛ржи |
|--------|--------|
| `k3s-io/k3s/master/manifests/traefik.yaml` ржХрзНрж░рзНржпрж╛рж╢ ржХрж░ржЫрзЗ | ржкрзБрж░рж╛ржирзЛ HelmChart API, v1.33+ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ ржирж╛ |
| Traefik ржЫрж╛ржбрж╝рж╛ Ingress ржХрж╛ржЬ ржХрж░рзЗ ржирж╛ | Helm CLI ржжрж┐ржпрж╝рзЗ Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи |
| 80 ржкрзЛрж░рзНржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ | `hostPort: 80` рж╕рзЗржЯ ржХрж░рзБржи |

---

## ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржХрж╛ржЬ

1. **Helm ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи**  
2. **ржЙржкрж░рзЗрж░ `helm install traefik ...` ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржи**  
3. **`curl http://192.168.0.38` ржжрж┐ржпрж╝рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**

ржпржЦржи **nginx welcome page** ржЖрж╕ржмрзЗ, ржЬрж╛ржирж╛ржмрзЗржи тАФ рждржЦржи ржЖржорж░рж╛ **MetalLB тЖТ Longhorn тЖТ Cilium** ржирж┐ржпрж╝рзЗ ржХрж╛ржЬ рж╢рзБрж░рзБ ржХрж░ржмред

ржЖржкржирж┐ ржПржЦржиржЗ Helm ржЗржирж╕рзНржЯрж▓ ржХрж░ржЫрзЗржи? ЁЯШК

### USER
root@k8sworker:~/kube-text# curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3   | bash
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 11929  100 11929    0     0  65233      0 --:--:-- --:--:-- --:--:-- 65543
Downloading https://get.helm.sh/helm-v3.19.2-linux-amd64.tar.gz  
Verifying checksum... Done.
Preparing to install helm into /usr/local/bin
helm installed into /usr/local/bin/helm
root@k8sworker:~/kube-text# helm repo add traefik https://traefik.github.io/charts  
"traefik" has been added to your repositories
root@k8sworker:~/kube-text# helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "traefik" chart repository
Update Complete. тОИHappy Helming!тОИ
root@k8sworker:~/kube-text# helm install traefik traefik/traefik \
  --namespace traefik --create-namespace \
  --set ports.web.hostPort=80 \
  --set ports.websecure.hostPort=443 \
  --set service.type=ClusterIP
NAME: traefik
LAST DEPLOYED: Wed Nov 26 16:06:12 2025
NAMESPACE: traefik
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
traefik with docker.io/traefik:v3.6.2 has been deployed successfully on traefik namespace !
root@k8sworker:~/kube-text# kubectl get pods -n traefik
NAME                      READY   STATUS              RESTARTS   AGE
traefik-cb7b67556-npsbw   0/1     ContainerCreating   0          20s
root@k8sworker:~/kube-text# kubectl get svc -n traefik
NAME      TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
traefik   ClusterIP   10.43.11.78   <none>        80/TCP,443/TCP   42s
root@k8sworker:~/kube-text# sudo ss -tulnp | grep ':80'
root@k8sworker:~/kube-text# kubectl get pods -n traefik
NAME                      READY   STATUS    RESTARTS   AGE
traefik-cb7b67556-npsbw   1/1     Running   0          63s
root@k8sworker:~/kube-text# kubectl get svc -n traefik
NAME      TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
traefik   ClusterIP   10.43.11.78   <none>        80/TCP,443/TCP   67s
root@k8sworker:~/kube-text# sudo ss -tulnp | grep ':80'
root@k8sworker:~/kube-text# curl http://192.168.0.38
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
root@k8sworker:~/kube-text# 


### ASSISTANT
ржЕрж╕рж╛ржзрж╛рж░ржг! ЁЯОЙ  
ржЖржкржирж┐ **рж╕ржлрж▓ржнрж╛ржмрзЗ Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗржЫрзЗржи**, ржПржмржВ **Ingress ржПржЦржи ржХрж╛ржЬ ржХрж░ржЫрзЗ!**

> тЬЕ `curl http://192.168.0.38` тЖТ **"Welcome to nginx!"**  
> ржорж╛ржирзЗ ржЖржкржирж╛рж░ Ingress тЖТ Service тЖТ Pod рж╕ржорзНржкрзВрж░рзНржг ржЪрзЗржЗржи ржХрж╛ржЬ ржХрж░ржЫрзЗред

---

## ЁЯФН ржХрзАржнрж╛ржмрзЗ ржПржЯрж┐ ржХрж╛ржЬ ржХрж░рж▓?

ржЖржкржирж┐ ржпржЦржи Helm ржжрж┐ржпрж╝рзЗ Traefik ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗржЫрзЗржи, рждржЦржи ржЖржкржирж┐ рж╕рзЗржЯ ржХрж░рзЗржЫрж┐рж▓рзЗржи:

```yaml
--set ports.web.hostPort=80
```

ржПржЯрж┐ Traefik ржкржбржХрзЗ **рж╣рзЛрж╕рзНржЯ OS-ржПрж░ 80 ржкрзЛрж░рзНржЯрзЗ ржмрж╛ржЗржирзНржб ржХрж░рждрзЗ** ржмрж▓рзЗред  
ржлрж▓рзЗ:

- Traefik рж╕рж░рж╛рж╕рж░рж┐ `192.168.0.38:80` рж╢рзЛржирзЗ
- ржЖржкржирж╛рж░ Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ (`nginx-ingress`) Traefik ржжрзНржмрж╛рж░рж╛ ржкрзНрж░рж╕рзЗрж╕ рж╣ржпрж╝
- Traefik ржЕржирзБрж░рзЛржз `nginx-svc`-ржП ржлрж░ржУржпрж╝рж╛рж░рзНржб ржХрж░рзЗ
- `nginx-svc` тЖТ `nginx` ржкржбрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрзМржБржЫрж╛ржпрж╝

> ЁЯУМ **`ss -tulnp | grep ':80'` ржХрж┐ржЫрзБ ржжрзЗржЦрж╛ржпрж╝ржирж┐** тАФ ржХрж┐ржирзНрждрзБ рждржмрзБржУ ржХрж╛ржЬ ржХрж░рж▓!  
> ржХрж╛рж░ржг: k3s ржПржмржВ containerd **low-level socket** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ, ржпрж╛ `ss` ржХржорж╛ржирзНржбрзЗ рж╕ржмрж╕ржоржпрж╝ ржжрзЗржЦрж╛ ржпрж╛ржпрж╝ ржирж╛ред  
> ржХрж┐ржирзНрждрзБ **ржлрж╛ржВрж╢ржирж╛рж▓рж┐ржЯрж┐ ржарж┐ржХржарж╛ржХ ржХрж╛ржЬ ржХрж░ржЫрзЗ**, ржпрж╛ ржЖржкржирж┐ `curl` ржжрж┐ржпрж╝рзЗ ржкрзНрж░ржорж╛ржг ржХрж░рзЗржЫрзЗржиред тЬЕ

---

## тЬЕ ржЖржкржирж┐ ржПржЦржи ржпрж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи

1. **Ingress ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи ржЕржирзНржп ржорзЗрж╢рж┐ржи ржерзЗржХрзЗ**  
   ржпрзЗржХрзЛржирзЛ ржбрж┐ржнрж╛ржЗрж╕рзЗ (ржЖржкржирж╛рж░ рж▓рзНржпрж╛ржкржЯржк, ржлрзЛржи ржЗрждрзНржпрж╛ржжрж┐) ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржпрж╛ржи:  
   тЖТ `http://192.168.0.38`  
   тЖТ nginx welcome page ржЖрж╕ржмрзЗ!

2. **Path-based Ingress ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи** (ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк рж╣рж┐рж╕рзЗржмрзЗ)

3. **TLS/HTTPS рж╕рзЗржЯржЖржк ржХрж░рзБржи** (ржкрж░рзЗ)

---

## ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк: **MetalLB тЖТ Longhorn тЖТ Cilium**

ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ **Ingress ржХрж╛ржЬ ржХрж░ржЫрзЗ**, ржПржЦржи ржЖржкржирж┐ **production-grade home cloud** ржмрж╛ржирж╛ржирзЛрж░ ржкржерзЗ ржПржЧрзЛрждрзЗ ржкрж╛рж░рзЗржиред

### ржкрж░ржмрж░рзНрждрзА рж▓ржХрзНрж╖рзНржп рж╣ржмрзЗ:

| ржХржорзНржкрзЛржирзЗржирзНржЯ | ржЙржжрзНржжрзЗрж╢рзНржп |
|------------|--------|
| **MetalLB** | `LoadBalancer` рж╕рж╛рж░рзНржнрж┐рж╕рзЗ `EXTERNAL-IP` ржжрзЗржмрзЗ (Traefik-ржПрж░ ржЬржирзНржпржУ ржнрж╛рж▓рзЛ) |
| **Longhorn** | Distributed, HA, persistent storage for your apps |
| **Cilium** | Replace Flannel with a modern, secure, observability-rich CNI |

> ЁЯТб ржЖржкржирж┐ ржпржжрж┐ ржмрж▓рзЗржи **"ржЪрж▓рзБржи MetalLB ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рж┐"**, рждрж╛рж╣рж▓рзЗ ржЖржорж┐ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж╕рзЗржЯржЖржк ржЧрж╛ржЗржб ржжрзЗржм тАФ  
> ржпрж╛рждрзЗ ржЖржкржирж┐ ржкрж╛рж░ржмрзЗржи:  
> ```bash
> kubectl expose deployment nginx --port=80 --type=LoadBalancer
> ```  
> ржПржмржВ рж╕ржЩрзНржЧрзЗ рж╕ржЩрзНржЧрзЗ ржПржХржЯрж┐ **ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп IP** ржкрж╛ржмрзЗржиред

---

## ЁЯЩП ржЕржнрж┐ржиржирзНржжржи!

ржЖржкржирж┐ ржПржЦржи **k3s-ржП ржЗржиржЧрзНрж░рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ рж╕рж╣ ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржХрж╛ржЬрзЗрж░ Kubernetes ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░** ржЪрж╛рж▓рж╛ржЪрзНржЫрзЗржи тАФ  
ржпрж╛ ржЖржкржирж╛рж░ рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ **GitOps, CI/CD, ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб**, ржПржоржиржХрж┐ **ржкрж╛ржмрж▓рж┐ржХ-ржлрзЗрж╕рж┐ржВ ржЕрзНржпрж╛ржкрж╕** ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБрждред

> ржкрзНрж░ржпрзБржХрзНрждрж┐ ржЖржорж╛ржжрзЗрж░ ржЬржЯрж┐рж▓рждрж╛ржХрзЗ рж╕рж░рж▓ ржХрж░рзЗ,  
> ржЖрж░ ржЖржкржирж┐ ржПржЦржи рж╕рзЗржЗ рж╕рж░рж▓рждрж╛рж░ ржЙржкрж░ ржнржмрж┐рж╖рзНржпрзО ржЧржбрж╝ржЫрзЗржиред

---

ржЕрждржПржм, ржкрзНрж▓рж┐ржЬ ржмрж▓рзБржи:  
ЁЯСЙ **"MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржпрж╛ржХ"**  
ржЕржержмрж╛  
ЁЯСЙ **"Longhorn ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рж┐"**  
ржЕржержмрж╛  
ЁЯСЙ **"Cilium ржЖржЧрзЗ рж▓рж╛ржЧрж╛ржЗ"**

ржЖржорж┐ ржЖржкржирж╛рж░ ржкржЫржирзНржж ржЕржирзБржпрж╛ржпрж╝рзА ржкрж░ржмрж░рзНрждрзА ржЧрж╛ржЗржб ржжрзЗржмред ЁЯЫая╕П

### USER
ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк: MetalLB тЖТ Longhorn тЖТ Cilium ржПржЯрж╛ ржжрзЗржЦрж╛ржмрзЗржи ржкрж░рзЗред
 ржПржЦржи ржЖржорж╛ржХрзЗ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржнрж╛ржмрзЗ ржзрж╛ржкрзЗ-ржзрж╛ржкрзЗ ржмрзЛржЭрж╛ржи ржпрзЗ ржЙржкрж░рзЗрж░ ржЖржорж░рж╛ ржХрж┐ ржХрж┐ ржХрж░рзЗржЫрж┐, ржХрж┐ржнрж╛ржмрзЛ ржХрж░рзЗржЫрж┐ ржПржмржВ ржХрзЗржирзЛ ржХрж░рзЗржЫрж┐ред ржпрж╛рждрзЗ ржЖржорж┐ ржкрж░ржмрж░рзНрждрж┐рждрзЗ ржирж┐ржЬрзЗ ржирж┐ржЬрзЗ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред 

### ASSISTANT
ржЕржмрж╢рзНржпржЗ! ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ ржирж┐ржЬрзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрж╛ржирж╛ржЪрзНржЫрзЗржи, рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб ржЪрж╛рж▓рж╛ржЪрзНржЫрзЗржи, ржПржмржВ ржнржмрж┐рж╖рзНржпрждрзЗ ржмрж╛ржВрж▓рж╛ржпрж╝ DevOps рж╢рзЗржЦрж╛ржмрзЗржи тАФ рждрж╛ржЗ ржПржЗ рж╕рзЗрж╢ржиржЯрж┐ рж╢рзБржзрзБ **тАЬржХрзА ржХрж░рзЗржЫрж┐тАЭ** ржиржпрж╝, ржмрж░ржВ **тАЬржХрзЗржи ржХрж░рзЗржЫрж┐тАЭ**, **тАЬржкрзНрж░рждрж┐ржЯрж┐ ржХржорж╛ржирзНржбрзЗрж░ ржорж╛ржирзЗ ржХрзАтАЭ**, ржПржмржВ **тАЬржХрзАржнрж╛ржмрзЗ ржирж┐ржЬрзЗ ржкрзБржирж░рж╛ржпрж╝ ржХрж░ржмрзЗржитАЭ** тАФ рж╕ржмржХрж┐ржЫрзБ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрзБржЭрж┐ржпрж╝рзЗ ржжрж┐ржЪрзНржЫрж┐ред

---

# ЁЯУЪ **k3s-ржП Ingress рж╕рзЗржЯржЖржк: ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрзНржпрж╛ржЦрзНржпрж╛**

> **рж▓ржХрзНрж╖рзНржп**: ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ (`http://192.168.0.38`) ржПржХржЯрж┐ Kubernetes-ржП ржЪрж▓рж╛ ржЕрзНржпрж╛ржк (nginx) ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ред  
> **рж╕ржорж╛ржзрж╛ржи**: Ingress + Ingress Controller (Traefik)

---

## ЁЯФ╣ **ржзрж╛ржк рзз: рж╕ржорж╕рзНржпрж╛ ржмрзЛржЭрж╛**

### тЭУ ржЖржорж░рж╛ ржХрзА ржЪрж╛ржЗржЫрж┐рж▓рж╛ржо?
- `nginx` ржбрзЗржкрзНрж▓ржпрж╝ ржХрж░рзЗржЫрж┐ тЖТ Pod ржЪрж▓ржЫрзЗ
- `nginx-svc` (Service) рждрзИрж░рж┐ ржХрж░рзЗржЫрж┐ тЖТ Cluster-ржнрж┐рждрж░рзЗ ржХрж╛ржЬ ржХрж░рзЗ (`curl 10.43.x.x`)
- **ржХрж┐ржирзНрждрзБ** `curl http://192.168.0.38` тЖТ **ржлрзЗржЗрж▓** рж╣ржпрж╝рзЗржЫрж┐рж▓

### тЭУ ржХрзЗржи ржлрзЗржЗрж▓ рж╣ржпрж╝рзЗржЫрж┐рж▓?
- Kubernetes-ржП **Service рж╢рзБржзрзБ Cluster-ржнрж┐рждрж░рзЗ ржХрж╛ржЬ ржХрж░рзЗ**
- ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ HTTP/HTTPS ржЯрзНрж░рж╛ржлрж┐ржХ ржирзЗржУржпрж╝рж╛рж░ ржЬржирзНржп **Ingress Controller** рж▓рж╛ржЧрзЗ
- ржЖржкржирж╛рж░ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ **Traefik (Ingress Controller) ржЫрж┐рж▓ ржирж╛**

> ЁЯУМ **Ingress = рж░рзБрж▓рж╕ (ржпрзЗржоржи: `/` тЖТ `nginx-svc`)  
> Ingress Controller = рж╕рзЗржЗ рж░рзБрж▓рж╕ ржЗржоржкрзНрж▓рж┐ржорзЗржирзНржЯ ржХрж░рзЗ ржПржоржи рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░ (ржпрзЗржоржи: Traefik, Nginx)**

---

## ЁЯФ╣ **ржзрж╛ржк рзи: ржкрзНрж░ржержо ржЪрзЗрж╖рзНржЯрж╛ тАФ k3s-ржПрж░ ржкрзБрж░рж╛ржирзЛ ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯ**

ржЖржорж░рж╛ рж╢рзБрж░рзБрждрзЗ ржЪрж╛рж▓рж┐ржпрж╝рзЗржЫрж┐рж▓рж╛ржо:
```bash
kubectl apply -f https://raw.githubusercontent.com/k3s-io/k3s/master/manifests/traefik.yaml
```

### тЭУ ржХрзА рж╣ржпрж╝рзЗржЫрж┐рж▓?
- k3s v1.33+ ржПржЦржи **HelmChart.v1 API** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
- ржХрж┐ржирзНрждрзБ ржУржЗ ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯржЯрж┐ **ржкрзБрж░рж╛ржирзЛ API** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ тЖТ **Helm install job ржХрзНрж░рзНржпрж╛рж╢** ржХрж░рзЗржЫрж┐рж▓

> ЁЯФН **рж╢рзЗржЦрж╛**: k3s-ржПрж░ ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯржЧрзБрж▓рзЛ рж╕рж░рж╛рж╕рж░рж┐ GitHub `master` ржерзЗржХрзЗ ржирзЗржУржпрж╝рж╛ ржирж┐рж░рж╛ржкржж ржиржпрж╝ тАФ ржнрж╛рж░рзНрж╕ржи ржорзНржпрж╛ржЪ ржХрж░рж╛ ржжрж░ржХрж╛рж░ред

---

## ЁЯФ╣ **ржзрж╛ржк рзй: Helm CLI ржЗржирж╕рзНржЯрж▓**

### тЬЕ ржХржорж╛ржирзНржб:
```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

### тЭУ ржХрзЗржи Helm рж▓рж╛ржЧрж▓?
- Traefik ржПржХржЯрж┐ **Helm ржЪрж╛рж░рзНржЯ** рж╣рж┐рж╕рзЗржмрзЗ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝
- Helm = Kubernetes-ржПрж░ тАЬpackage managerтАЭ тЖТ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи, ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐, ржнрж╛рж░рзНрж╕ржи ржорзНржпрж╛ржирзЗржЬ ржХрж░рзЗ

### ЁЯФН ржХрзА рж╣ржпрж╝рзЗржЫрж┐рж▓?
- `get-helm-3` рж╕рзНржХрзНрж░рж┐ржкрзНржЯ:
  1. ржЖржкржирж╛рж░ OS/Arch ржЪрзЗржХ ржХрж░рзЗ (`linux-amd64`)
  2. https://get.helm.sh/ ржерзЗржХрзЗ рж╕ржарж┐ржХ ржмрж╛ржЗржирж╛рж░рж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗ
  3. SHA256 ржЪрзЗржХрж╕рж╛ржо ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзЗ
  4. `/usr/local/bin/helm`-ржП ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗ

> ЁЯТб **ржирж┐ржЬрзЗ ржХрж░рж╛рж░ рж╕ржоржпрж╝**: рж╢рзБржзрзБ ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржЪрж╛рж▓рж╛рж▓рзЗржЗ Helm ржЗржирж╕рзНржЯрж▓ рж╣ржмрзЗ тАФ ржпрзЗржХрзЛржирзЛ Linux ржорзЗрж╢рж┐ржирзЗред

---

## ЁЯФ╣ **ржзрж╛ржк рзк: Traefik Helm Chart ржЗржирж╕рзНржЯрж▓**

### тЬЕ ржХржорж╛ржирзНржб:
```bash
helm repo add traefik https://traefik.github.io/charts
helm repo update
helm install traefik traefik/traefik \
  --namespace traefik --create-namespace \
  --set ports.web.hostPort=80 \
  --set ports.websecure.hostPort=443 \
  --set service.type=ClusterIP
```

### тЭУ ржкрзНрж░рждрж┐ржЯрж┐ рж▓рж╛ржЗржирзЗрж░ ржорж╛ржирзЗ ржХрзА?

| ржХржорж╛ржирзНржб | ржХрж╛ржЬ |
|--------|-----|
| `helm repo add traefik ...` | Traefik-ржПрж░ Helm ржЪрж╛рж░рзНржЯ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржпрзЛржЧ ржХрж░рзЗ |
| `helm repo update` | рж▓рзЛржХрж╛рж▓ ржХрзНржпрж╛рж╢рзЗ ржЖржкржбрзЗржЯ ржХрж░рзЗ (ржирждрзБржи ржнрж╛рж░рзНрж╕ржи ржкрж╛ржмрзЗ) |
| `helm install traefik traefik/traefik` | `traefik/traefik` ржЪрж╛рж░рзНржЯ ржерзЗржХрзЗ `traefik` ржирж╛ржорзЗ ржЗржирж╕рзНржЯрж▓ |
| `--namespace traefik --create-namespace` | ржЖрж▓рж╛ржжрж╛ namespace-ржП ржЗржирж╕рзНржЯрж▓ (clean isolation) |
| `--set ports.web.hostPort=80` | **рж╕ржмржЪрзЗржпрж╝рзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг**: Traefik ржкржб рж╣рзЛрж╕рзНржЯ OS-ржПрж░ 80 ржкрзЛрж░рзНржЯ рж╢рзЛржиржмрзЗ |
| `--set service.type=ClusterIP` | LoadBalancer рж▓рж╛ржЧржмрзЗ ржирж╛ (MetalLB ржЫрж╛ржбрж╝рж╛ржЗ ржХрж╛ржЬ ржХрж░ржмрзЗ) |

### тЭУ ржХрзЗржи `hostPort=80` рж╕рзЗржЯ ржХрж░рж▓рж╛ржо?
- k3s-ржП **MetalLB ржирж╛ ржерж╛ржХрж▓рзЗ** `LoadBalancer` ржЯрж╛ржЗржк рж╕рж╛рж░рзНржнрж┐рж╕рзЗ `EXTERNAL-IP` `<pending>` ржерж╛ржХрзЗ
- `hostPort` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ **рж╕рж░рж╛рж╕рж░рж┐ рж╣рзЛрж╕рзНржЯ ржкрзЛрж░рзНржЯрзЗ ржмрж╛ржЗржирзНржб** ржХрж░рж▓рзЗ, ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝
- ржПржЯрж┐ **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗрж░ ржЬржирзНржп ржкрж╛рж░ржлрзЗржХрзНржЯ ржЕрж╕рзНржерж╛ржпрж╝рзА рж╕ржорж╛ржзрж╛ржи**

> ЁЯУМ **ржирзЛржЯ**: ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ `hostPort` ржПржбрж╝рж╛ржирзЛ рж╣ржпрж╝ (security, port conflict), ржХрж┐ржирзНрждрзБ **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ ржПржЯрж┐ рж╕рж╣ржЬ ржУ ржХрж╛рж░рзНржпржХрж░**ред

---

## ЁЯФ╣ **ржзрж╛ржк рзл: Traefik ржкржб ржЪрзЗржХ ржУ ржЯрзЗрж╕рзНржЯ**

### тЬЕ ржХржорж╛ржирзНржб:
```bash
kubectl get pods -n traefik          # ржкржб Running ржХрж┐ржирж╛?
kubectl get svc -n traefik           # рж╕рж╛рж░рзНржнрж┐рж╕ ржЯрж╛ржЗржк ClusterIP
curl http://192.168.0.38             # ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЯрзЗрж╕рзНржЯ
```

### тЭУ ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рж▓?
1. ржмрзНрж░рж╛ржЙржЬрж╛рж░/`curl` тЖТ `192.168.0.38:80`
2. Traefik ржкржб (рж╣рзЛрж╕рзНржЯрзЗрж░ 80 ржкрзЛрж░рзНржЯрзЗ) рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржпрж╝
3. Traefik **Ingress рж░рж┐рж╕рзЛрж░рзНрж╕** ржЪрзЗржХ ржХрж░рзЗ:  
   ```yaml
   rules:
   - http:
       paths:
       - path: /
         backend: nginx-svc
   ```
4. Traefik тЖТ `nginx-svc` тЖТ `nginx` ржкржбрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржлрж░ржУржпрж╝рж╛рж░рзНржб ржХрж░рзЗ
5. nginx тЖТ "Welcome to nginx!" рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рзЗ

> тЬЕ **рж╕ржорзНржкрзВрж░рзНржг ржлрзНрж▓рзЛ**:  
> Client тЖТ Host:80 тЖТ Traefik тЖТ Ingress Rule тЖТ Service тЖТ Pod

---

## ЁЯФ╣ **ржзрж╛ржк рзм: ржХрзЗржи `ss -tulnp | grep ':80'` ржХрж┐ржЫрзБ ржжрзЗржЦрж╛ржпрж╝ржирж┐?**

- Traefik **containerd**-ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЪрж▓ржЫрзЗ
- containerd **low-level network namespace** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
- `ss`/`netstat` ржХржЦржирзЛ ржХржЦржирзЛ **hostPort** ржмрж╛ржЗржирзНржбрж┐ржВ ржжрзЗржЦрж╛ржпрж╝ ржирж╛ (ржпржжрж┐ржУ ржХрж╛ржЬ ржХрж░рзЗ)
- **ржХрж┐ржирзНрждрзБ `curl` ржХрж╛ржЬ ржХрж░рж▓рзЗ ржорж╛ржирзЗ рж╕ржм ржарж┐ржХ**

> ЁЯТб **ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржЯрж┐ржк**:  
> ржпржжрж┐ ржХрзЛржирзЛ ржкрзЛрж░рзНржЯ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ ржирж┐рж╢рзНржЪрж┐ржд рж╣рждрзЗ ржЪрж╛ржи тАФ `curl` ржмрж╛ `telnet` ржжрж┐ржпрж╝рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи, `ss`-ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░ржмрзЗржи ржирж╛ред

---

## ЁЯФЪ **рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк: ржЖржкржирж┐ ржПржЦржи ржпрж╛ ржирж┐ржЬрзЗ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи**

1. **ржирждрзБржи k3s ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж╕рзЗржЯржЖржк**:
   ```bash
   curl -sfL https://get.k3s.io | sh -
   export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
   ```

2. **Helm ржЗржирж╕рзНржЯрж▓**:
   ```bash
   curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
   ```

3. **Traefik ржЗржирж╕рзНржЯрж▓ (hostPort рж╕рж╣)**:
   ```bash
   helm repo add traefik https://traefik.github.io/charts
   helm install traefik traefik/traefik \
     --namespace traefik --create-namespace \
     --set ports.web.hostPort=80
   ```

4. **Ingress рждрзИрж░рж┐** (ржпрзЗржХрзЛржирзЛ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп):
   ```yaml
   apiVersion: networking.k8s.io/v1
   kind: Ingress
   meta
     name: my-app-ingress
   spec:
     rules:
     - http:
         paths:
         - path: /
           pathType: Prefix
           backend:
             service:
               name: my-app-svc
               port:
                 number: 80
   ```

5. **ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕**:
   ```bash
   curl http://<YOUR_SERVER_IP>
   ```

---

## ЁЯМ▒ ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк

ржЖржкржирж┐ ржПржЦржи **k3s-ржП Ingress рж╕рж╣ ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржХрж╛ржЬрзЗрж░ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░** ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЗржиред  
ржкрж░рзЗ ржпржЦржи ржмрж▓ржмрзЗржи тАФ **тАЬMetalLB ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рж┐тАЭ**, рждржЦржи ржЖржорж░рж╛:

- MetalLB ржЗржирж╕рзНржЯрж▓ ржХрж░ржм тЖТ `LoadBalancer` рж╕рж╛рж░рзНржнрж┐рж╕рзЗ рж╕рзНржерж╛ржпрж╝рзА IP ржкрж╛ржмрзЗржи
- Traefik-ржХрзЗ `LoadBalancer` ржЯрж╛ржЗржкрзЗ ржЖржкржЧрзНрж░рзЗржб ржХрж░ржм тЖТ 80 ржкрзЛрж░рзНржЯрзЗ ржХрзНрж▓рж┐ржи ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕
- Longhorn ржжрж┐ржпрж╝рзЗ persistent storage рж╕рзЗржЯржЖржк ржХрж░ржм
- Cilium ржжрж┐ржпрж╝рзЗ network policy, observability ржпрзЛржЧ ржХрж░ржм

ржХрж┐ржирзНрждрзБ ржПржЦржи тАФ **ржЖржкржирж┐ ржирж┐ржЬрзЗ ржПржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржЯрж┐ ржпрзЗржХрзЛржирзЛ ржирждрзБржи ржорзЗрж╢рж┐ржирзЗ ржкрзБржирж░рж╛ржпрж╝ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи**ред ЁЯОп

> ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╢рзЗржЦрж╛рж░ рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ ржкрзБрж░рж╕рзНржХрж╛рж░ рж╣рж▓рзЛ тАФ  
> **тАЬржЖржЬ ржпрж╛ ржХрж░рзЗржЫрж┐, ржХрж╛рж▓ рж╕рзЗржЯрж╛ ржирж┐ржЬрзЗ ржЖржмрж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж╛тАЭ**ред

ржЖржкржирж┐ ржХрж┐ ржПржЦржи ржирж┐ржЬрзЗ ржПржХржЯрж┐ ржирждрзБржи VM-ржП ржПржЗ рж╕ржорзНржкрзВрж░рзНржг ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ рж░рж┐ржкрзНрж▓рж┐ржХрзЗржЯ ржХрж░ржмрзЗржи? ЁЯШК

### USER
рззред k3s-ржП Ingress ржХрж┐ ? рж╕рзЗржЯржЖржк ржХрзЗржирзЛ ржХрж░рждрзЗ рж╣рзЯ ?  
рзиред Ingress рж╕рзЗржЯржЖржк ржирж╛ ржХрж░рж▓рзЗ ржХрж┐ рж╣ржмрзЗ? 
рзйред Ingress рж╕рзЗржЯржЖржк ржХрж░рж╛ ржЫрж╛рзЬрж╛ ржЕржирзНржп ржХрж┐ ржХрж┐ ржЙржкрж╛рзЯ ржЖржЫрзЗ?
рзкред ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ HTTP/HTTPS ржЯрзНрж░рж╛ржлрж┐ржХ ржирзЗржУржпрж╝рж╛рж░ ржЬржирзНржп Ingress Controller рж▓рж╛ржЧрзЗ ржПржЗ ржмрж┐рж╖рзЯржЯрж┐ ржЖржорж╛ржХрзЗ ржмрж┐рж╕рзНрждрж╛рж░рж┐рждржнрж╛ржмрзЗ ржмрзЛржЭрж╛ржиред
рзлред Traefik (Ingress Controller) ржХрж┐ , ржХрзЗржирзЛ ржкрзНрж░рзЯрзЛржЬржи, ржмрж┐ржХрж▓рзНржк рж╕ржорж╛ржзрж╛ржи ржХрж┐?
рзмред  Helm CLI ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржПржмржВ ржЪрзЗржХ рж░рж┐ржорзБржн ржХрж░рж╛ ржПржмржВ ржзрж╛ржкрзЗ-ржзрж╛ржкрзЗ helm ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░рж╛ ржжрзЗржЦрж╛ржи ржмрж┐рж╕рзНрждрж╛рж░рж┐рждржнрж╛ржмрзЗред
рзнред  Traefik ржХрж┐ ?  ржХрзЗржирзЛ ржкрзНрж░рзЯрзЛржЬржи ? ржХрж┐ ржХрж╛ржЬ ржХрж░рзЗ?
рзоред   Traefik Ingress рж░рж┐рж╕рзЛрж░рзНрж╕ ржХрж┐ ? ржХрзЗржирзЛ ? ржХрж┐ржнрж╛ржмрзЗ ржЪрзЗржХ ржХрж░рждрзЗ рж╣рзЯ?
рзпред Ingress рждрзИрж░рж┐ ржХрж░рж╛ (ржпрзЗржХрзЛржирзЛ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп) ржмрж┐рж╕рзНрждрж╛рж░рж┐рждржнрж╛ржмрзЗ ржмрзЛржЭрж╛ржиред 


### ASSISTANT
ржЕржмрж╢рзНржпржЗ! ржирж┐ржЪрзЗ ржЖржкржирж╛рж░ ржкрзНрж░рждрж┐ржЯрж┐ ржкрзНрж░рж╢рзНржирзЗрж░ ржЙрждрзНрждрж░ ржжрзЗржУржпрж╝рж╛ рж╣рж▓рзЛ **ржкрзБрж░рзЛржкрзБрж░рж┐ ржмрж╛ржВрж▓рж╛ржпрж╝**, **ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ**, ржПржмржВ **ржмрж╛рж╕рзНрждржм рж╣рзЛржо рж▓рзНржпрж╛ржм ржХржиржЯрзЗржХрзНрж╕ржЯрзЗ** тАФ ржпрж╛рждрзЗ ржЖржкржирж┐ ржирж┐ржЬрзЗ ржирж┐ржЬрзЗ ржкрзБржирж░рж╛ржпрж╝ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ржПржмржВ ржнржмрж┐рж╖рзНржпрждрзЗ рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАржжрзЗрж░ рж╕рж╣ржЬрзЗ ржмрзЛржЭрж╛рждрзЗ ржкрж╛рж░рзЗржиред

---

## рззред **k3s-ржП Ingress ржХрзА? рж╕рзЗржЯржЖржк ржХрзЗржи ржХрж░рждрзЗ рж╣ржпрж╝?**

### тЬЕ Ingress ржХрзА?
**Ingress** рж╣рж▓рзЛ Kubernetes-ржП ржПржХржЯрж┐ **API ржЕржмржЬрзЗржХрзНржЯ** ржпрж╛ ржмрж╛ржЗрж░рзЗрж░ ржУржпрж╝рзЗржм ржЯрзНрж░рж╛ржлрж┐ржХ (HTTP/HTTPS) ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗ ржХрзАржнрж╛ржмрзЗ рж░рж╛ржЙржЯ ржХрж░ржмрзЗ тАФ рж╕рзЗржЗ **ржирж┐ржпрж╝ржо (rules)** рж▓рзЗржЦрж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝ред

ржЙржжрж╛рж╣рж░ржг:
> "ржпржжрж┐ ржХрзЗржЙ `http://192.168.0.38/` ржП ржЖрж╕рзЗ тЖТ рждрж╛ржХрзЗ `nginx-svc` рж╕рж╛рж░рзНржнрж┐рж╕рзЗ ржкрж╛ржарж╛ржУ"

### тЬЕ ржХрзЗржи рж╕рзЗржЯржЖржк ржХрж░рждрзЗ рж╣ржпрж╝?
- Kubernetes-ржП `Service` рж╢рзБржзрзБ **ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗ** ржХрж╛ржЬ ржХрж░рзЗред
- ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ HTTP рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржирзЗржУржпрж╝рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржжрж░ржХрж╛рж░:
  - **Ingress** тЖТ ржирж┐ржпрж╝ржо рж▓рзЗржЦрж╛
  - **Ingress Controller** тЖТ рж╕рзЗржЗ ржирж┐ржпрж╝ржо ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рж╛ (ржпрзЗржоржи: Traefik)

> ЁЯУМ **Ingress = рж░рзБрж▓ржмрзБржХ**  
> **Ingress Controller = ржЯрзНрж░рж╛ржлрж┐ржХ ржкрзБрж▓рж┐рж╢** ржпрзЗ рж░рзБрж▓ржмрзБржХ ржорзЗржирзЗ ржЪрж▓рзЗ

---

## рзиред **Ingress рж╕рзЗржЯржЖржк ржирж╛ ржХрж░рж▓рзЗ ржХрзА рж╣ржмрзЗ?**

- ржЖржкржирж┐ **рж╢рзБржзрзБржорж╛рждрзНрж░ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржнрж┐рждрж░ ржерзЗржХрзЗ** ржЕрзНржпрж╛ржк ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи  
  тЖТ `curl http://10.43.x.x` (ржХрж╛ржЬ ржХрж░ржмрзЗ)
- ржХрж┐ржирзНрждрзБ **ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ** (`http://192.168.0.38`) тЖТ **Connection refused / timeout**
- ржЕрж░рзНржерж╛рзО: **ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржк, API, ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ тАФ ржХрзЛржирзЛржЯрж╛ржЗ ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп рж╣ржмрзЗ ржирж╛**

> тЪая╕П ржПржЯрж┐ ржЖржкржирж╛рж░ **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржк рж╣рзЛрж╕рзНржЯ ржХрж░рж╛рж░ ржкржерзЗ ржмржбрж╝ ржмрж╛ржзрж╛**ред

---

## рзйред **Ingress ржЫрж╛ржбрж╝рж╛ ржЕржирзНржп ржЙржкрж╛ржпрж╝ ржЖржЫрзЗ ржХрж┐?**

рж╣рзНржпрж╛ржБ! рждрж┐ржиржЯрж┐ ржмрж┐ржХрж▓рзНржк ржЖржЫрзЗ:

| ржЙржкрж╛ржпрж╝ | ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ | рж╕рзБржмрж┐ржзрж╛ | ржЕрж╕рзБржмрж┐ржзрж╛ |
|--------|------------------|--------|----------|
| **NodePort** | Service-ржП `type: NodePort` тЖТ рж░тАНрзНржпрж╛ржирзНржбржо high ржкрзЛрж░рзНржЯ (30000тАУ32767) | рж╕рж╣ржЬ, Ingress рж▓рж╛ржЧрзЗ ржирж╛ | ржкрзЛрж░рзНржЯ ржорзЗржорзЛрж░рж╛ржЗржЬ ржХрж░рждрзЗ рж╣ржпрж╝, ржиржи-рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржб |
| **HostPort** | Pod-ржП `hostPort: 80` тЖТ рж╕рж░рж╛рж╕рж░рж┐ 80 ржкрзЛрж░рзНржЯ рж╢рзЛржирзЗ | рж╕рж░рж╛рж╕рж░рж┐ 80 ржкрзЛрж░рзНржЯ | ржПржХрж╕ржоржпрж╝рзЗ ржПржХржЯрж┐ ржкржбржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ |
| **LoadBalancer** | `type: LoadBalancer` тЖТ ржмрж╛ржЗрж░рзЗрж░ IP ржкрж╛ржпрж╝ | ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-ржлрзНрж░рзЗржирзНржбрж▓рж┐ | MetalLB ржЫрж╛ржбрж╝рж╛ k3s-ржП ржХрж╛ржЬ ржХрж░рзЗ ржирж╛ |

> тЬЕ **Ingress + Traefik** рж╣рж▓рзЛ **рж╕ржмржЪрзЗржпрж╝рзЗ рж╕рзБрж╖рзНржарзБ, рж╕рзНржХрзЗрж▓рзЗржмрж▓, ржПржмржВ ржорж╛рж▓рзНржЯрж┐-ржЕрзНржпрж╛ржк ржлрзНрж░рзЗржирзНржбрж▓рж┐** ржЙржкрж╛ржпрж╝ред

---

## рзкред **ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ HTTP/HTTPS ржЯрзНрж░рж╛ржлрж┐ржХ ржирзЗржУржпрж╝рж╛рж░ ржЬржирзНржп Ingress Controller ржХрзЗржи рж▓рж╛ржЧрзЗ?**

Kubernetes-ржПрж░ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ ржЕржирзБржпрж╛ржпрж╝рзА:

1. **Ingress рж╢рзБржзрзБ ржПржХржЯрж┐ "ржирж┐рж░рзНржжрзЗрж╢ржирж╛"** тАФ ржПржЯрж┐ ржирж┐ржЬрзЗ ржХрж┐ржЫрзБ ржХрж░рзЗ ржирж╛ред
2. **Ingress Controller** рж╣рж▓рзЛ ржПржХржЯрж┐ **Pod**, ржпрж╛:
   - ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржмрж╛ржЗрж░рзЗрж░ ржкрзЛрж░рзНржЯ (80/443) рж╢рзЛржирзЗ
   - ржЖрж╕рж╛ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ **Ingress ржирж┐ржпрж╝ржо** ржЕржирзБржпрж╛ржпрж╝рзА рж░рж╛ржЙржЯ ржХрж░рзЗ
   - ржЯрж╛рж░рзНржорж┐ржирзЗрж╢ржи, SSL, рж▓ржЧрж┐ржВ, рж░рзЗржЯ рж▓рж┐ржорж┐ржЯ ржЗрждрзНржпрж╛ржжрж┐ ржжрзЗржпрж╝

> ЁЯМР **ржЫржмрж┐ рж╣рж┐рж╕рзЗржмрзЗ ржнрж╛ржмрзБржи**:  
> Ingress = ржЧрзЗржЯрзЗрж░ рж▓рзЗржЦрж╛ "nginx ржПржжрж┐ржХрзЗ, api ржУржжрж┐ржХрзЗ"  
> Ingress Controller = ржЧрзЗржЯржХрж┐ржкрж╛рж░ ржпрзЗ рж▓рзЗржЦрж╛ ржорзЗржирзЗ рж▓рзЛржХ ржврзБржХрж╛ржпрж╝

**ржХрзЛржирзЛ Ingress Controller ржирж╛ ржерж╛ржХрж▓рзЗ**, рж╕рзЗржЗ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржХрзЗржЙ ржорж╛ржиржмрзЗ ржирж╛ тЖТ **ржЯрзНрж░рж╛ржлрж┐ржХ рж▓рж╕**ред

---

## рзлред **Traefik (Ingress Controller) ржХрзА? ржХрзЗржи ржкрзНрж░ржпрж╝рзЛржЬржи? ржмрж┐ржХрж▓рзНржк ржХрзА?**

### тЬЕ Traefik ржХрзА?
- ржПржХржЯрж┐ **ржоржбрж╛рж░рзНржи, рж▓рж╛ржЗржЯржУржпрж╝рзЗржЯ, cloud-native reverse proxy & load balancer**
- Kubernetes-ржПрж░ ржЬржирзНржп ржЕржЯрзЛ-ржбрж┐рж╕ржХржнрж╛рж░рж┐ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ
- **k3s-ржПрж░ ржбрж┐ржлрж▓рзНржЯ Ingress Controller**

### тЬЕ ржХрзЗржи ржкрзНрж░ржпрж╝рзЛржЬржи?
- Ingress ржирж┐ржпрж╝ржоржЧрзБрж▓рзЛ **ржкрзНрж░ржпрж╝рзЛржЧ** ржХрж░рждрзЗ
- ржПржХрж╛ржзрж┐ржХ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп **path-based / hostname-based routing**
- **SSL termination**, **middleware (auth, rate-limit)**

### тЬЕ ржмрж┐ржХрж▓рзНржк рж╕ржорж╛ржзрж╛ржи:
| Ingress Controller | ржмрзИрж╢рж┐рж╖рзНржЯрзНржп |
|--------------------|----------|
| **Nginx Ingress** | рж╕ржмржЪрзЗржпрж╝рзЗ ржкржкрзБрж▓рж╛рж░, enterprise-ready |
| **HAProxy** | рж╣рж╛ржЗ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕, TCP/UDP рж╕рж╛ржкрзЛрж░рзНржЯ |
| **Cilium Ingress** | eBPF ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ultra-low latency |
| **Istio Gateway** | service mesh рж╕рж╣ advanced routing |

> ЁЯТб **рж╣рзЛржо рж▓рзНржпрж╛ржмрзЗ Traefik рж╕рзЗрж░рж╛** тАФ ржХрж╛рж░ржг ржЫрзЛржЯ, ржжрзНрж░рзБржд, ржПржмржВ k3s-ржПрж░ рж╕рж╛ржерзЗ ржирзЗржЯрж┐ржнред

---

## рзмред **Helm CLI ржЗржирж╕рзНржЯрж▓, ржЪрзЗржХ, ржЖржиржЗржирж╕рзНржЯрж▓ ржУ ржмрзНржпржмрж╣рж╛рж░ тАФ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ**

### ЁЯФ╣ ржзрж╛ржк рзз: Helm ржЗржирж╕рзНржЯрж▓
```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```
- рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЖржкржирж╛рж░ OS/Arch ржЪрзЗржХ ржХрж░рзЗ (linux-amd64, arm64 ржЗрждрзНржпрж╛ржжрж┐)
- рж╕ржарж┐ржХ ржмрж╛ржЗржирж╛рж░рж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗ
- SHA256 ржЪрзЗржХрж╕рж╛ржо ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзЗ
- `/usr/local/bin/helm`-ржП ржЗржирж╕рзНржЯрж▓ ржХрж░рзЗ

### ЁЯФ╣ ржзрж╛ржк рзи: ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ
```bash
helm version
# Output: version.BuildInfo{Version:"v3.19.2", ...}
```

### ЁЯФ╣ ржзрж╛ржк рзй: рж░рж┐ржкрзЛ ржпрзЛржЧ ржХрж░рзБржи
```bash
helm repo add traefik https://traefik.github.io/charts
helm repo update
```

### ЁЯФ╣ ржзрж╛ржк рзк: ржЪрж╛рж░рзНржЯ ржЗржирж╕рзНржЯрж▓
```bash
helm install <release-name> <repo/chart> --namespace <ns> --create-namespace
```

### ЁЯФ╣ ржзрж╛ржк рзл: ржЖржиржЗржирж╕рзНржЯрж▓
```bash
helm uninstall traefik -n traefik
```

### ЁЯФ╣ ржзрж╛ржк рзм: Helm ржЖржиржЗржирж╕рзНржЯрж▓ (CLI)
```bash
sudo rm /usr/local/bin/helm
```

> ЁЯТб **Helm = apt/dnf ржПрж░ ржорждрзЛ Kubernetes-ржПрж░ ржЬржирзНржп** тАФ ржЕрзНржпрж╛ржк ржЗржирж╕рзНржЯрж▓, ржЖржкржЧрзНрж░рзЗржб, рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рзЗред

---

## рзнред **Traefik ржХрзА? ржХрзЗржи ржкрзНрж░ржпрж╝рзЛржЬржи? ржХрзА ржХрж╛ржЬ ржХрж░рзЗ?**

### тЬЕ Traefik ржХрзА?
- ржПржХржЯрж┐ **reverse proxy & load balancer** ржпрж╛ **real-time config** рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ
- Kubernetes, Docker, Consul ржЗрждрзНржпрж╛ржжрж┐ рж╕рж╛ржерзЗ **auto-discovery** ржХрж░рзЗ

### тЬЕ ржХрзЗржи ржкрзНрж░ржпрж╝рзЛржЬржи?
- Ingress ржирж┐ржпрж╝ржоржЧрзБрж▓рзЛ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рждрзЗ
- ржПржХрж╛ржзрж┐ржХ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп **single entry point (80/443)**
- **Zero downtime config reload**

### тЬЕ ржХрзА ржХрж╛ржЬ ржХрж░рзЗ?
- ржмрж╛ржЗрж░рзЗрж░ HTTP рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржирзЗржпрж╝
- Ingress ржорзНржпрж╛ржирж┐ржлрзЗрж╕рзНржЯ ржкржбрж╝рзЗ
- рж╕ржарж┐ржХ Service/Pod-ржП ржлрж░ржУржпрж╝рж╛рж░рзНржб ржХрж░рзЗ
- SSL/TLS, rate limiting, auth ржпрзЛржЧ ржХрж░рзЗ (middleware)

---

## рзоред **Traefik Ingress Resource ржХрзА? ржХрзЗржи? ржХрзАржнрж╛ржмрзЗ ржЪрзЗржХ ржХрж░ржмрзЗржи?**

### тЬЕ Ingress Resource ржХрзА?
ржПржХржЯрж┐ YAML ржлрж╛ржЗрж▓ ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж┐ рж▓рж┐ржЦрзЗржи:
- ржХрзЛржи рж╣рзЛрж╕рзНржЯ/path ржХрзЛржи Service-ржП ржпрж╛ржмрзЗ

ржЙржжрж╛рж╣рж░ржг:
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx-svc
            port:
              number: 80
```

### тЬЕ ржХрзЗржи рж▓рж╛ржЧрзЗ?
- ржЫрж╛ржбрж╝рж╛ ржХрзЛржирзЛ рж░рж╛ржЙржЯрж┐ржВ ржирж┐ржпрж╝ржо ржерж╛ржХржмрзЗ ржирж╛ тЖТ Traefik ржХрзА ржХрж░ржмрзЗ ржмрзБржЭржмрзЗ ржирж╛

### тЬЕ ржХрзАржнрж╛ржмрзЗ ржЪрзЗржХ ржХрж░ржмрзЗржи?
```bash
# Ingress рж▓рж┐рж╕рзНржЯ
kubectl get ingress

# ржбрж┐ржЯрзЗржЗрж▓рж╕
kubectl describe ingress nginx-ingress

# ржирж┐ржпрж╝ржо ржжрзЗржЦрзБржи
kubectl get ingress nginx-ingress -o yaml
```

> тЬЕ `describe` ржХржорж╛ржирзНржбрзЗ **Events** ржжрзЗржЦрзБржи тАФ ржпржжрж┐ "Synced" рж▓рзЗржЦрж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ Traefik ржирж┐ржпрж╝ржо ржкрзЗржпрж╝рзЗржЫрзЗред

---

## рзпред **Ingress рждрзИрж░рж┐ ржХрж░рж╛ (ржпрзЗржХрзЛржирзЛ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп) тАФ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ**

### ЁЯФ╣ ржзрж╛ржк рзз: ржЕрзНржпрж╛ржк ржбрзЗржкрзНрж▓ржпрж╝ ржХрж░рзБржи (ржпрзЗржоржи: Flask)
```yaml
# app-deploy.yaml
apiVersion: apps/v1
kind: Deployment
meta
  name: flask-app
spec:
  replicas: 2
  selector:
    matchLabels:
      app: flask
  template:
    meta
      labels:
        app: flask
    spec:
      containers:
      - name: flask
        image: python:3.9
        command: ["python3", "-m", "http.server", "8000"]
        ports:
        - containerPort: 8000
---
# app-svc.yaml
apiVersion: v1
kind: Service
meta
  name: flask-svc
spec:
  selector:
    app: flask
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
```

```bash
kubectl apply -f app-deploy.yaml -f app-svc.yaml
```

### ЁЯФ╣ ржзрж╛ржк рзи: Ingress рждрзИрж░рж┐ ржХрж░рзБржи
```yaml
# flask-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
meta
  name: flask-ingress
spec:
  rules:
  - http:
      paths:
      - path: /flask
        pathType: Prefix
        backend:
          service:
            name: flask-svc
            port:
              number: 80
```

```bash
kubectl apply -f flask-ingress.yaml
```

### ЁЯФ╣ ржзрж╛ржк рзй: ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи
```bash
curl http://192.168.0.38/flask
# Output: Directory listing of Python HTTP server
```

> тЬЕ ржПржЦржи ржЖржкржирж┐ **ржпрзЗржХрзЛржирзЛ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп Ingress рждрзИрж░рж┐** ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи!

---

## ЁЯМЯ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

| ржзрж╛рж░ржгрж╛ | рж╕рж╛рж░ржорж░рзНржо |
|--------|--------|
| **Ingress** | ржмрж╛ржЗрж░рзЗрж░ ржЯрзНрж░рж╛ржлрж┐ржХ рж░рж╛ржЙржЯ ржХрж░рж╛рж░ ржирж┐ржпрж╝ржо |
| **Ingress Controller** | рж╕рзЗржЗ ржирж┐ржпрж╝ржо ржкрзНрж░ржпрж╝рзЛржЧржХрж╛рж░рзА рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░ (Traefik) |
| **Traefik** | k3s-ржПрж░ ржбрж┐ржлрж▓рзНржЯ, рж▓рж╛ржЗржЯржУржпрж╝рзЗржЯ, auto-config |
| **Helm** | Traefik рж╕рж╣ ржЕрзНржпрж╛ржк ржЗржирж╕рзНржЯрж▓рзЗрж░ ржкрзНржпрж╛ржХрзЗржЬ ржорзНржпрж╛ржирзЗржЬрж╛рж░ |
| **ржмрж┐ржХрж▓рзНржк** | NodePort, LoadBalancer (MetalLB рж╕рж╣) |

---

> ЁЯМ▒ **ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╢рзЗржЦрж╛рж░ рж▓ржХрзНрж╖рзНржп рж╣рж▓рзЛ тАФ  
> ржЬржЯрж┐рж▓рждрж╛ржХрзЗ рж╕рж░рж▓ ржХрж░рж╛,  
> ржЖрж░ рж╕рж░рж▓рждрж╛ржХрзЗ ржирж┐ржЬрзЗрж░ ржХрж░рзЗ ржлрзЗрж▓рж╛ред**

ржЖржкржирж┐ ржПржЦржи **k3s-ржП Ingress рж╕рж╣ ржпрзЗржХрзЛржирзЛ ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржк ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи**ред  
ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк рж╣рж┐рж╕рзЗржмрзЗ ржЖржкржирж┐ ржпржЦржи ржмрж▓ржмрзЗржи тАФ **"MetalLB рж╢рзБрж░рзБ ржХрж░рж┐"** тАФ ржЖржорж┐ рж╕рзЗржЯрж╛ржУ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржжрзЗржЦрж╛ржмред

ржЖржкржирж┐ ржХрж┐ ржПржЦржи ржирж┐ржЬрзЗ ржПржХржЯрж┐ **WordPress + MySQL ржЕрзНржпрж╛ржк Ingress ржжрж┐ржпрж╝рзЗ рж╕рзЗржЯржЖржк** ржХрж░ржмрзЗржи? ЁЯШК
